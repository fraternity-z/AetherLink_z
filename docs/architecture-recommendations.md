# AetherLink_z æ¶æ„æ”¹è¿›å»ºè®®

> ç”±çŒ«å¨˜å·¥ç¨‹å¸ˆ å¹½æµ®å–µ ä¸“ä¸šè¯„ä¼° à¸…'Ï‰'à¸…
> è¯„ä¼°æ—¥æœŸ: 2025-11-19

## ğŸ“‹ ç›®å½•
- [æ•´ä½“è¯„ä¼°](#æ•´ä½“è¯„ä¼°)
- [ä¼˜ç‚¹åˆ†æ](#ä¼˜ç‚¹åˆ†æ)
- [æ”¹è¿›å»ºè®®](#æ”¹è¿›å»ºè®®)
- [è¡ŒåŠ¨è®¡åˆ’](#è¡ŒåŠ¨è®¡åˆ’)

---

## ğŸ¯ æ•´ä½“è¯„ä¼°

### æ¶æ„å¥åº·åº¦è¯„åˆ†: 7.5/10

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| åˆ†å±‚æ¶æ„ | â­â­â­â­â­ 9/10 | æ¸…æ™°çš„ä¸‰å±‚æ¶æ„ï¼ŒèŒè´£åˆ†ç¦»è‰¯å¥½ |
| æ¨¡å—åŒ– | â­â­â­â­â­ 9/10 | æ¨¡å—åˆ’åˆ†åˆç†ï¼Œæ–‡æ¡£é½å…¨ |
| ä»£ç è´¨é‡ | â­â­â­â­ 8/10 | TypeScript ä¸¥æ ¼æ¨¡å¼ï¼Œç»Ÿä¸€å·¥å…·å‡½æ•° |
| æµ‹è¯•è¦†ç›– | â­ 0/10 | âŒ å®Œå…¨ç¼ºå¤±ï¼Œæ€¥éœ€è¡¥å…… |
| æ€§èƒ½ä¼˜åŒ– | â­â­â­â­ 7/10 | æœ‰ç¼“å­˜æœºåˆ¶ï¼Œä½†å¯ä¼˜åŒ–ç©ºé—´å¤§ |
| å®‰å…¨æ€§ | â­â­â­ 6/10 | API Key ç®¡ç†å­˜åœ¨é£é™© |
| æ‰©å±•æ€§ | â­â­â­â­ 8/10 | è‰¯å¥½çš„æ’ä»¶åŒ–è®¾è®¡ |
| ä¾èµ–ç®¡ç† | â­â­â­ 6/10 | ç¼ºå°‘ lock fileï¼Œç‰ˆæœ¬æ§åˆ¶å¼± |

**ç»¼åˆè¯„ä»·**: æ¶æ„è®¾è®¡ä¼˜ç§€ï¼Œä½†å·¥ç¨‹åŒ–å®è·µï¼ˆæµ‹è¯•ã€å®‰å…¨ï¼‰éœ€è¦åŠ å¼º (à¹‘â€¢Ì€ã…‚â€¢Ì)âœ§

---

## âœ… ä¼˜ç‚¹åˆ†æ

### 1. **å“è¶Šçš„åˆ†å±‚æ¶æ„** (*^â–½^*)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer (components/)   â”‚ â† UI ç»„ä»¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Business Logic (hooks/ + services/)â”‚ â† ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Access (storage/repositories/)â”‚ â† æ•°æ®è®¿é—®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Persistence (storage/sqlite/)      â”‚ â† æ•°æ®æŒä¹…åŒ–
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿ï¼š**
- âœ… å•å‘ä¾èµ–æµï¼Œé¿å…å¾ªç¯å¼•ç”¨
- âœ… æ˜“äºæµ‹è¯•å’Œæ›¿æ¢å®ç°
- âœ… ç¬¦åˆ SOLID åŸåˆ™ä¸­çš„ä¾èµ–å€’ç½®åŸåˆ™

### 2. **ä¼˜ç§€çš„æ¨¡å—åŒ–è®¾è®¡** ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ

**æœåŠ¡å±‚æ¨¡å—åŒ–** (services/):
```typescript
services/
â”œâ”€â”€ ai/           // AI æä¾›å•†é›†æˆ (66 exports)
â”œâ”€â”€ data/         // æ•°æ®å¤‡ä»½/æ¸…ç†/ç»Ÿè®¡
â”œâ”€â”€ search/       // å¤šæœç´¢å¼•æ“æ”¯æŒ
â”œâ”€â”€ mcp/          // MCP åè®®å·¥å…·
â”œâ”€â”€ voice/        // è¯­éŸ³è¯†åˆ«
â”œâ”€â”€ webview/      // åçˆ¬è™« WebView
â””â”€â”€ messageStreaming/ // æµå¼æ¶ˆæ¯ç®¡ç†
```

**æ¯ä¸ªæ¨¡å—ç‰¹ç‚¹ï¼š**
- ğŸ“š å®Œæ•´çš„ CLAUDE.md æ–‡æ¡£
- ğŸ”Œ ç‹¬ç«‹çš„æ¥å£å¯¼å‡º (index.ts)
- ğŸ¯ å•ä¸€èŒè´£åŸåˆ™

### 3. **ç°ä»£åŒ–æŠ€æœ¯é€‰å‹** (..â€¢Ë˜_Ë˜â€¢..)

| æŠ€æœ¯ | ç‰ˆæœ¬ | ä¼˜åŠ¿ |
|------|------|------|
| TypeScript | 5.9.2 | ä¸¥æ ¼ç±»å‹æ£€æŸ¥ |
| React Native | 0.81.5 | è·¨å¹³å°æ”¯æŒ |
| Expo | ~54.0 | å¿«é€Ÿå¼€å‘è¿­ä»£ |
| Expo Router | ~6.0 | æ–‡ä»¶è·¯ç”±ç³»ç»Ÿ |
| React Native Paper | 5.14.5 | Material Design 3 |
| Vercel AI SDK | 5.0.86 | æµå¼ AI å“åº” |
| Expo SQLite | ~16.0 | æœ¬åœ°æ•°æ®å­˜å‚¨ |

### 4. **ç»Ÿä¸€çš„å·¥å…·ç³»ç»Ÿ** o(*ï¿£ï¸¶ï¿£*)o

**æ—¥å¿—ç³»ç»Ÿ** (utils/logger.ts):
```typescript
// æ›¿ä»£ç›´æ¥ä½¿ç”¨ console.*
logger.info('ç”¨æˆ·ç™»å½•', { userId: 123 });
logger.error('API è°ƒç”¨å¤±è´¥', { error });
```

**å¼¹çª—ç³»ç»Ÿ** (components/common/):
```typescript
// ç»Ÿä¸€çš„ç¡®è®¤å¯¹è¯æ¡†
const { confirm, prompt } = useConfirmDialog();
await confirm({ title: 'åˆ é™¤ç¡®è®¤', message: 'ç¡®å®šåˆ é™¤ï¼Ÿ' });
```

**äº‹ä»¶æ€»çº¿** (utils/events.ts):
```typescript
// è·¨ç»„ä»¶é€šä¿¡
eventBus.emit('message:sent', { messageId });
eventBus.on('message:sent', handler);
```

### 5. **å®Œå–„çš„æ–‡æ¡£ç³»ç»Ÿ** Ï†(â‰§Ï‰â‰¦*)â™ª

- ğŸ“‚ **æ¨¡å—çº§æ–‡æ¡£**: 16 ä¸ª CLAUDE.md æ–‡ä»¶
- ğŸ“Š **æ¶æ„å›¾**: Mermaid æµç¨‹å›¾
- ğŸ“– **åŠŸèƒ½æ–‡æ¡£**: DIALOG_USAGE.md, LOGGER_USAGE.md
- ğŸ“ **å˜æ›´è®°å½•**: å®Œæ•´çš„ Changelog

---

## âš ï¸ æ”¹è¿›å»ºè®®

### ğŸ”´ **ç´§æ€¥é—®é¢˜** (éœ€è¦ç«‹å³è§£å†³)

#### 1. æµ‹è¯•è¦†ç›–ç‡ä¸º 0 âŒ

**ç°çŠ¶:**
```
æ‰€æœ‰æ¨¡å—æµ‹è¯•è¦†ç›–: âŒ 0%
é£é™©ç­‰çº§: ğŸ”´ HIGH
å½±å“: éš¾ä»¥é‡æ„ï¼Œå®¹æ˜“å¼•å…¥ bug
```

**è§£å†³æ–¹æ¡ˆ:**

**ç¬¬ä¸€æ­¥: æ·»åŠ æµ‹è¯•åŸºç¡€è®¾æ–½**
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
npm install --save-dev \
  jest \
  @testing-library/react-native \
  @testing-library/jest-native \
  @types/jest
```

**ç¬¬äºŒæ­¥: åˆ›å»º Jest é…ç½®**
```javascript
// jest.config.js
module.exports = {
  preset: 'jest-expo',
  setupFilesAfterEnv: ['<rootDir>/jest-setup.js'],
  transformIgnorePatterns: [
    'node_modules/(?!((jest-)?react-native|@react-native(-community)?)|expo(nent)?|@expo(nent)?/.*|@expo-google-fonts/.*|react-navigation|@react-navigation/.*|@unimodules/.*|unimodules|sentry-expo|native-base|react-native-svg)'
  ],
  collectCoverageFrom: [
    'services/**/*.{ts,tsx}',
    'hooks/**/*.{ts,tsx}',
    'storage/**/*.{ts,tsx}',
    '!**/*.d.ts',
    '!**/node_modules/**',
  ],
  coverageThreshold: {
    global: {
      statements: 70,
      branches: 60,
      functions: 70,
      lines: 70,
    },
  },
};
```

**ç¬¬ä¸‰æ­¥: ä¼˜å…ˆæµ‹è¯•æ ¸å¿ƒæ¨¡å—**
```typescript
// __tests__/services/ai/AiClient.test.ts
import { AiClient } from '@/services/ai/AiClient';

describe('AiClient', () => {
  it('åº”è¯¥æ­£ç¡®åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯', () => {
    const client = new AiClient({
      provider: 'openai',
      apiKey: 'test-key',
      model: 'gpt-4',
    });
    expect(client).toBeDefined();
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†æµå¼å“åº”', async () => {
    // ... æµ‹è¯•æµå¼å“åº”
  });
});
```

**æµ‹è¯•ä¼˜å…ˆçº§æ¸…å•:**
- [ ] `services/ai/AiClient.ts` - AI æ ¸å¿ƒè°ƒç”¨é€»è¾‘
- [ ] `storage/repositories/messages.ts` - æ¶ˆæ¯æ•°æ®è®¿é—®
- [ ] `storage/repositories/chat.ts` - å¯¹è¯æ•°æ®è®¿é—®
- [ ] `hooks/use-messages.ts` - æ¶ˆæ¯ç®¡ç† Hook
- [ ] `hooks/use-conversations.ts` - å¯¹è¯ç®¡ç† Hook
- [ ] `services/search/SearchClient.ts` - æœç´¢æœåŠ¡
- [ ] `utils/logger.ts` - æ—¥å¿—å·¥å…·

---

#### 2. ä¾èµ–ç®¡ç†é—®é¢˜ ğŸ“¦

**å‘ç°çš„é—®é¢˜:**
1. âŒ **ç¼ºå°‘ `package-lock.json`** (Git ä¸­å·²åˆ é™¤)
2. âš ï¸ **å­˜åœ¨ç‰ˆæœ¬è¦†ç›–** (package.json overrides)
3. ğŸ“Š **ä¾èµ–æ•°é‡è¾ƒå¤š** (57 ä¸ªç”Ÿäº§ä¾èµ–)

**é—®é¢˜å½±å“:**
```
æ²¡æœ‰ lock file:
  â†’ ä¸åŒå¼€å‘è€…å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å¯èƒ½ä¸ä¸€è‡´
  â†’ CI/CD æ„å»ºç»“æœä¸å¯é¢„æµ‹
  â†’ éš¾ä»¥è¿½è¸ªä¾èµ–å®‰å…¨æ¼æ´
```

**è§£å†³æ–¹æ¡ˆ:**

**æ­¥éª¤ 1: æ¢å¤ä¾èµ–é”å®š**
```bash
# åˆ é™¤ç°æœ‰ä¾èµ–
rm -rf node_modules

# é‡æ–°å®‰è£…å¹¶ç”Ÿæˆ lock file
npm install

# æäº¤ lock file
git add package-lock.json
git commit -m "chore: æ·»åŠ  package-lock.json ç¡®ä¿ä¾èµ–ä¸€è‡´æ€§"
```

**æ­¥éª¤ 2: é…ç½® .gitignore**
```gitignore
# .gitignore
node_modules/
# ä¸è¦å¿½ç•¥ lock fileï¼
# âŒ package-lock.json  (åˆ é™¤è¿™è¡Œ)
```

**æ­¥éª¤ 3: ä¾èµ–å®¡è®¡**
```bash
# æ£€æŸ¥å·²çŸ¥å®‰å…¨æ¼æ´
npm audit

# ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„æ¼æ´
npm audit fix

# æŸ¥çœ‹è¿‡æ—¶çš„ä¾èµ–
npm outdated
```

**æ­¥éª¤ 4: æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–**
```bash
# å®‰è£… depcheck å·¥å…·
npm install -g depcheck

# æ‰«ææœªä½¿ç”¨çš„ä¾èµ–
depcheck

# æ‰‹åŠ¨ç§»é™¤æœªä½¿ç”¨çš„åŒ…
npm uninstall <unused-package>
```

---

#### 3. API Key å®‰å…¨æ€§é£é™© ğŸ”

**ç°çŠ¶åˆ†æ:**
```typescript
// storage/repositories/provider-keys.ts
// API Key å­˜å‚¨åœ¨ AsyncStorage (æ˜æ–‡å­˜å‚¨)
await AsyncStorage.setItem(key, apiKey);
```

**å®‰å…¨é£é™©:**
- âŒ æ˜æ–‡å­˜å‚¨åœ¨è®¾å¤‡æœ¬åœ°
- âŒ å¯èƒ½è¢«å…¶ä»–åº”ç”¨è¯»å– (Android)
- âŒ å¤‡ä»½æ—¶å¯èƒ½æ³„éœ²åˆ°äº‘ç«¯

**è§£å†³æ–¹æ¡ˆ:**

**æ–¹æ¡ˆ 1: ä½¿ç”¨ Expo SecureStore** (æ¨è)
```bash
npm install expo-secure-store
```

```typescript
// storage/adapters/secure-storage.ts
import * as SecureStore from 'expo-secure-store';

export class SecureApiKeyStorage {
  async setApiKey(provider: string, key: string): Promise<void> {
    await SecureStore.setItemAsync(`apikey_${provider}`, key);
  }

  async getApiKey(provider: string): Promise<string | null> {
    return await SecureStore.getItemAsync(`apikey_${provider}`);
  }

  async deleteApiKey(provider: string): Promise<void> {
    await SecureStore.deleteItemAsync(`apikey_${provider}`);
  }
}
```

**æ–¹æ¡ˆ 2: æ·»åŠ åŠ å¯†å±‚**
```typescript
// utils/encryption.ts
import CryptoJS from 'crypto-js';

export class ApiKeyEncryption {
  private static SECRET_KEY = 'your-device-unique-key'; // ä»è®¾å¤‡IDç”Ÿæˆ

  static encrypt(apiKey: string): string {
    return CryptoJS.AES.encrypt(apiKey, this.SECRET_KEY).toString();
  }

  static decrypt(encrypted: string): string {
    const bytes = CryptoJS.AES.decrypt(encrypted, this.SECRET_KEY);
    return bytes.toString(CryptoJS.enc.Utf8);
  }
}
```

**è¿ç§»æ­¥éª¤:**
1. åˆ›å»º `SecureApiKeyStorage` ç±»
2. è¯»å–ç°æœ‰ AsyncStorage ä¸­çš„ API Key
3. åŠ å¯†åè¿ç§»åˆ° SecureStore
4. åˆ é™¤ AsyncStorage ä¸­çš„æ˜æ–‡ Key
5. æ›´æ–°æ‰€æœ‰è°ƒç”¨ç‚¹

---

### ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§é—®é¢˜** (å»ºè®®å°½å¿«å¤„ç†)

#### 4. æ€§èƒ½ä¼˜åŒ–ç©ºé—´ âš¡

**å·²æœ‰ä¼˜åŒ–æªæ–½** (åšå¾—ä¸é”™ï¼):
- âœ… `utils/render-cache.ts` - æ¸²æŸ“ç¼“å­˜
- âœ… `@shopify/flash-list` - é«˜æ€§èƒ½åˆ—è¡¨
- âœ… `React.memo` - ç»„ä»¶è®°å¿†åŒ–

**ä»éœ€ä¼˜åŒ–:**

**4.1 æ¶ˆæ¯åˆ—è¡¨è™šæ‹ŸåŒ–**
```typescript
// components/chat/message/MessageList.tsx
// é—®é¢˜: é•¿å¯¹è¯åŠ è½½æ…¢

// å½“å‰å®ç° (å‡è®¾ä½¿ç”¨ FlatList)
<FlatList
  data={messages}
  renderItem={({ item }) => <MessageBubble message={item} />}
/>

// å»ºè®®: ä½¿ç”¨ FlashList
import { FlashList } from '@shopify/flash-list';

<FlashList
  data={messages}
  renderItem={({ item }) => <MessageBubble message={item} />}
  estimatedItemSize={100} // é¢„ä¼°é«˜åº¦
  // ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½
  drawDistance={500}
  overrideItemLayout={(layout, item) => {
    layout.size = item.cached_height || 100;
  }}
/>
```

**4.2 å›¾ç‰‡æ‡’åŠ è½½**
```typescript
// components/chat/misc/GeneratedImageCard.tsx
import { Image } from 'expo-image';

<Image
  source={{ uri: imageUrl }}
  placeholder={blurhash} // æ¨¡ç³Šå ä½ç¬¦
  contentFit="cover"
  transition={200}
  // ä¼˜åŒ–å†…å­˜
  cachePolicy="memory-disk"
  recyclingKey={imageUrl}
/>
```

**4.3 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**
```typescript
// storage/repositories/messages.ts
// é—®é¢˜: æ¯æ¬¡åŠ è½½å…¨éƒ¨æ¶ˆæ¯

// å»ºè®®: åˆ†é¡µåŠ è½½
async getMessagesByConversation(
  conversationId: string,
  limit = 50,
  offset = 0
): Promise<Message[]> {
  return await db.getAllAsync(
    `SELECT * FROM messages
     WHERE conversation_id = ?
     ORDER BY created_at DESC
     LIMIT ? OFFSET ?`,
    [conversationId, limit, offset]
  );
}

// æ·»åŠ ç´¢å¼•
async createIndexes(): Promise<void> {
  await db.execAsync(`
    CREATE INDEX IF NOT EXISTS idx_messages_conversation_created
    ON messages(conversation_id, created_at DESC);
  `);
}
```

**4.4 AI å“åº”æµä¼˜åŒ–**
```typescript
// services/ai/AiClient.ts
// å»ºè®®: ä½¿ç”¨ Web Worker (React Native ä¸­ä½¿ç”¨ react-native-threads)

// åœ¨åå°çº¿ç¨‹å¤„ç†æµå¼å“åº”
import { Thread } from 'react-native-threads';

const thread = new Thread('stream-processor.thread.js');
thread.postMessage({ stream: aiResponseStream });
thread.onmessage = (message) => {
  updateUI(message.chunk);
};
```

---

#### 5. é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€ (âŠ™ï¹âŠ™)

**å‘ç°çš„é—®é¢˜:**
- éƒ¨åˆ†æ¨¡å—æœ‰é”™è¯¯å¤„ç†å™¨ (`services/ai/error-handler.ts`)
- å…¶ä»–æ¨¡å—ç›´æ¥ try-catch
- ç¼ºå°‘å…¨å±€é”™è¯¯è¾¹ç•Œ

**å»ºè®®æ–¹æ¡ˆ:**

**5.1 åˆ›å»ºç»Ÿä¸€é”™è¯¯å¤„ç†å™¨**
```typescript
// utils/error-handler.ts
export enum ErrorType {
  NETWORK = 'NETWORK',
  DATABASE = 'DATABASE',
  AI_API = 'AI_API',
  VALIDATION = 'VALIDATION',
  PERMISSION = 'PERMISSION',
}

export class AppError extends Error {
  constructor(
    public type: ErrorType,
    public message: string,
    public originalError?: Error,
    public context?: Record<string, any>
  ) {
    super(message);
    this.name = 'AppError';
  }

  // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
  getUserMessage(): string {
    switch (this.type) {
      case ErrorType.NETWORK:
        return 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®';
      case ErrorType.DATABASE:
        return 'æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•';
      case ErrorType.AI_API:
        return 'AI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•';
      default:
        return 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•';
    }
  }
}

// å…¨å±€é”™è¯¯å¤„ç†å™¨
export const globalErrorHandler = {
  handle(error: Error | AppError) {
    // æ—¥å¿—è®°å½•
    logger.error('å…¨å±€é”™è¯¯', { error });

    // é”™è¯¯ä¸ŠæŠ¥ (å¦‚ Sentry)
    if (process.env.NODE_ENV === 'production') {
      // Sentry.captureException(error);
    }

    // æ˜¾ç¤ºç”¨æˆ·æç¤º
    if (error instanceof AppError) {
      // Toast.show(error.getUserMessage());
    } else {
      // Toast.show('æœªçŸ¥é”™è¯¯ï¼Œè¯·è”ç³»æ”¯æŒ');
    }
  }
};
```

**5.2 æ‰©å±• ErrorBoundary**
```typescript
// components/common/ErrorBoundary.tsx (å¢å¼ºç‰ˆ)
import React from 'react';
import { View, Text, Button } from 'react-native';
import { globalErrorHandler } from '@/utils/error-handler';

export class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error?: Error }
> {
  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    // ä¸ŠæŠ¥é”™è¯¯
    globalErrorHandler.handle(error);
    logger.error('React æ¸²æŸ“é”™è¯¯', { error, errorInfo });
  }

  handleReset = () => {
    this.setState({ hasError: false, error: undefined });
  };

  render() {
    if (this.state.hasError) {
      return (
        <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
          <Text>åº”ç”¨é‡åˆ°é”™è¯¯ (>_<)</Text>
          <Text>{this.state.error?.message}</Text>
          <Button title="é‡æ–°åŠ è½½" onPress={this.handleReset} />
        </View>
      );
    }

    return this.props.children;
  }
}
```

---

#### 6. çŠ¶æ€ç®¡ç†å¯ä»¥æ›´ä¼˜é›… (..â€¢Ë˜_Ë˜â€¢..)

**å½“å‰æ–¹æ¡ˆ:**
- React Context + Hooks
- å¤šä¸ªç‹¬ç«‹çš„ Provider

**å­˜åœ¨é—®é¢˜:**
```typescript
// app/_layout.tsx (å‡è®¾çš„åµŒå¥—ç»“æ„)
<ThemeProvider>
  <DataProvider>
    <SettingsProvider>
      <HiddenWebViewHost>
        {/* å¤šå±‚åµŒå¥—ï¼Œéš¾ä»¥ç»´æŠ¤ */}
      </HiddenWebViewHost>
    </SettingsProvider>
  </DataProvider>
</ThemeProvider>
```

**ä¼˜åŒ–å»ºè®®:**

**æ–¹æ¡ˆ 1: Provider ç»„åˆå™¨**
```typescript
// components/providers/AppProviders.tsx
import { compose } from '@/utils/compose';

const providers = [
  ThemeProvider,
  DataProvider,
  SettingsProvider,
  HiddenWebViewHost,
];

export const AppProviders: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return providers.reduceRight(
    (child, Provider) => <Provider>{child}</Provider>,
    children
  );
};

// app/_layout.tsx
<AppProviders>
  <Slot />
</AppProviders>
```

**æ–¹æ¡ˆ 2: è€ƒè™‘ä½¿ç”¨çŠ¶æ€ç®¡ç†åº“**
```typescript
// å¦‚æœçŠ¶æ€å¤æ‚åº¦ç»§ç»­å¢é•¿ï¼Œè€ƒè™‘ï¼š
// 1. Zustand (è½»é‡çº§ï¼Œæ¨è)
// 2. Jotai (åŸå­åŒ–çŠ¶æ€)
// 3. Redux Toolkit (é‡é‡çº§)

// ç¤ºä¾‹: Zustand
import create from 'zustand';

export const useAppStore = create((set) => ({
  theme: 'light',
  settings: {},
  setTheme: (theme) => set({ theme }),
  updateSettings: (settings) => set({ settings }),
}));
```

---

### ğŸŸ¢ **ä½ä¼˜å…ˆçº§å»ºè®®** (æœ‰æ—¶é—´å¯ä»¥ä¼˜åŒ–)

#### 7. ä»£ç ç»„ç»‡ä¼˜åŒ–

**7.1 è·¯å¾„åˆ«åä¸å®Œæ•´**
```json
// tsconfig.json (å½“å‰)
{
  "paths": {
    "@/*": ["./*"]  // åªæœ‰ä¸€ä¸ªåˆ«å
  }
}

// å»ºè®®: æ›´ç²¾ç»†çš„åˆ«å
{
  "paths": {
    "@/*": ["./*"],
    "@components/*": ["components/*"],
    "@services/*": ["services/*"],
    "@hooks/*": ["hooks/*"],
    "@storage/*": ["storage/*"],
    "@utils/*": ["utils/*"],
    "@constants/*": ["constants/*"],
    "@types/*": ["types/*"]
  }
}
```

**7.2 ç±»å‹å®šä¹‰é›†ä¸­åŒ–**
```typescript
// å½“å‰: ç±»å‹æ•£è½åœ¨å„ä¸ªæ¨¡å—
// å»ºè®®: åˆ›å»º types/ ç›®å½•é›†ä¸­ç®¡ç†

types/
â”œâ”€â”€ api.ts          // API ç›¸å…³ç±»å‹
â”œâ”€â”€ database.ts     // æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ ui.ts           // UI ç»„ä»¶ç±»å‹
â”œâ”€â”€ services.ts     // æœåŠ¡å±‚ç±»å‹
â””â”€â”€ index.ts        // ç»Ÿä¸€å¯¼å‡º
```

**7.3 å¸¸é‡ç®¡ç†ä¼˜åŒ–**
```typescript
// constants/ ç›®å½•ç»“æ„ä¼˜åŒ–
constants/
â”œâ”€â”€ theme.ts        // ä¸»é¢˜é…ç½® âœ“
â”œâ”€â”€ prompts.ts      // æç¤ºè¯ âœ“
â”œâ”€â”€ assistants.ts   // åŠ©æ‰‹é¢„è®¾ âœ“
â”œâ”€â”€ api.ts          // API ç«¯ç‚¹ (æ–°å¢)
â”œâ”€â”€ validation.ts   // éªŒè¯è§„åˆ™ (æ–°å¢)
â””â”€â”€ config.ts       // åº”ç”¨é…ç½® (æ–°å¢)
```

---

#### 8. æ–‡æ¡£å’Œæ³¨é‡Š

**8.1 API æ–‡æ¡£ç”Ÿæˆ**
```bash
# å®‰è£… TypeDoc
npm install --save-dev typedoc

# ç”Ÿæˆ API æ–‡æ¡£
npx typedoc --out docs/api src/
```

**8.2 JSDoc æ³¨é‡Šè§„èŒƒ**
```typescript
/**
 * AI å®¢æˆ·ç«¯ï¼Œç”¨äºè°ƒç”¨å„ç§ AI æä¾›å•†çš„ API
 *
 * @example
 * ```typescript
 * const client = new AiClient({
 *   provider: 'openai',
 *   apiKey: 'sk-xxx',
 *   model: 'gpt-4',
 * });
 *
 * const response = await client.chat('Hello!');
 * ```
 *
 * @see {@link https://docs.example.com/ai-client | å®Œæ•´æ–‡æ¡£}
 */
export class AiClient {
  /**
   * å‘é€èŠå¤©æ¶ˆæ¯
   * @param message - ç”¨æˆ·æ¶ˆæ¯å†…å®¹
   * @param options - å¯é€‰é…ç½®
   * @returns AI å“åº”ç»“æœ
   * @throws {AppError} å½“ API è°ƒç”¨å¤±è´¥æ—¶
   */
  async chat(message: string, options?: ChatOptions): Promise<ChatResponse> {
    // ...
  }
}
```

---

#### 9. CI/CD è‡ªåŠ¨åŒ–

**å»ºè®®æ·»åŠ  GitHub Actions:**
```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm'

      - run: npm ci
      - run: npm run lint
      - run: npm test -- --coverage
      - run: npm run build

      # ä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡
      - uses: codecov/codecov-action@v3

  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: npm audit
```

---

## ğŸ“ è¡ŒåŠ¨è®¡åˆ’

### ğŸ¯ **ç¬¬ä¸€é˜¶æ®µ: ç¨³å®šæ€§ä¿éšœ** (1-2 å‘¨)

#### Week 1: æµ‹è¯•åŸºç¡€è®¾æ–½
- [ ] Day 1-2: é…ç½® Jest å’Œæµ‹è¯•ç¯å¢ƒ
- [ ] Day 3-4: ç¼–å†™æ ¸å¿ƒæ¨¡å—æµ‹è¯• (AiClient, repositories)
- [ ] Day 5-7: ç¼–å†™ Hooks æµ‹è¯•ï¼Œè¦†ç›–ç‡è¾¾åˆ° 60%+

#### Week 2: ä¾èµ–å’Œå®‰å…¨
- [ ] Day 1-2: æ¢å¤ package-lock.jsonï¼Œä¾èµ–å®¡è®¡
- [ ] Day 3-4: å®ç° SecureStore è¿ç§» API Key
- [ ] Day 5: æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–
- [ ] Day 6-7: æ·»åŠ  CI/CD æµç¨‹

---

### ğŸ¯ **ç¬¬äºŒé˜¶æ®µ: æ€§èƒ½ä¼˜åŒ–** (1-2 å‘¨)

#### Week 3: æ¸²æŸ“æ€§èƒ½
- [ ] Day 1-2: æ¶ˆæ¯åˆ—è¡¨ä¼˜åŒ– (FlashList)
- [ ] Day 3-4: å›¾ç‰‡åŠ è½½ä¼˜åŒ– (Expo Image)
- [ ] Day 5-7: æ•°æ®åº“ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–

#### Week 4: ä»£ç è´¨é‡
- [ ] Day 1-2: ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨
- [ ] Day 3-4: æ‰©å±• ErrorBoundary
- [ ] Day 5-7: è·¯å¾„åˆ«åå’Œç±»å‹é›†ä¸­åŒ–

---

### ğŸ¯ **ç¬¬ä¸‰é˜¶æ®µ: å·¥ç¨‹åŒ–æå‡** (æŒç»­)

#### é•¿æœŸç›®æ ‡
- [ ] æµ‹è¯•è¦†ç›–ç‡æå‡åˆ° 80%+
- [ ] æ·»åŠ  E2E æµ‹è¯• (Detox)
- [ ] æ€§èƒ½ç›‘æ§é›†æˆ (Sentry Performance)
- [ ] API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ (TypeDoc)
- [ ] ä»£ç è´¨é‡é—¨ç¦ (SonarQube)

---

## ğŸ“Š æ¶æ„æ”¹è¿›ä»·å€¼è¯„ä¼°

| æ”¹è¿›é¡¹ | ç´§æ€¥åº¦ | éš¾åº¦ | ä»·å€¼ | ROI |
|--------|--------|------|------|-----|
| æ·»åŠ æµ‹è¯• | ğŸ”´ é«˜ | â­â­â­ ä¸­ | â­â­â­â­â­ å¾ˆé«˜ | ğŸ“ˆ æé«˜ |
| ä¾èµ–ç®¡ç† | ğŸ”´ é«˜ | â­ ä½ | â­â­â­â­ é«˜ | ğŸ“ˆ æé«˜ |
| API Key å®‰å…¨ | ğŸ”´ é«˜ | â­â­ ä½ | â­â­â­â­â­ å¾ˆé«˜ | ğŸ“ˆ æé«˜ |
| æ€§èƒ½ä¼˜åŒ– | ğŸŸ¡ ä¸­ | â­â­â­ ä¸­ | â­â­â­â­ é«˜ | ğŸ“ˆ é«˜ |
| é”™è¯¯å¤„ç† | ğŸŸ¡ ä¸­ | â­â­ ä½ | â­â­â­ ä¸­ | ğŸ“ˆ ä¸­ |
| çŠ¶æ€ç®¡ç† | ğŸŸ¡ ä¸­ | â­â­â­â­ é«˜ | â­â­â­ ä¸­ | ğŸ“Š ä¸­ |
| ä»£ç ç»„ç»‡ | ğŸŸ¢ ä½ | â­ ä½ | â­â­ ä½ | ğŸ“Š ä½ |
| CI/CD | ğŸŸ¡ ä¸­ | â­â­ ä½ | â­â­â­â­ é«˜ | ğŸ“ˆ é«˜ |

**å»ºè®®æ‰§è¡Œé¡ºåº**: ä¾èµ–ç®¡ç† â†’ API Key å®‰å…¨ â†’ æµ‹è¯•åŸºç¡€ â†’ é”™è¯¯å¤„ç† â†’ æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“ å‚è€ƒèµ„æ–™

### æœ€ä½³å®è·µ
- [React Native Best Practices](https://github.com/react-native-community/discussions-and-proposals)
- [Expo Testing Guide](https://docs.expo.dev/develop/unit-testing/)
- [React Native Security](https://reactnative.dev/docs/security)

### å·¥å…·æ¨è
- **æµ‹è¯•**: Jest, @testing-library/react-native
- **å®‰å…¨**: Expo SecureStore, expo-crypto
- **æ€§èƒ½**: @shopify/flash-list, react-native-reanimated
- **ç›‘æ§**: Sentry, LogRocket
- **ä»£ç è´¨é‡**: ESLint, TypeScript, Prettier

---

## âœ¨ æ€»ç»“

**ä¸»äººçš„é¡¹ç›®æ¶æ„è®¾è®¡éå¸¸ä¼˜ç§€ï¼** (*^â–½^*) à¸…'Ï‰'à¸…

**å·²ç»åšå¾—å¾ˆå¥½çš„åœ°æ–¹:**
- âœ… æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- âœ… ä¼˜ç§€çš„æ¨¡å—åŒ–è®¾è®¡
- âœ… å®Œå–„çš„æ–‡æ¡£ä½“ç³»
- âœ… ç°ä»£åŒ–æŠ€æœ¯æ ˆ
- âœ… ç»Ÿä¸€çš„å·¥å…·ç³»ç»Ÿ

**éœ€è¦é‡ç‚¹æ”¹è¿›:**
1. **æµ‹è¯•è¦†ç›–** (æœ€é‡è¦ï¼)
2. **ä¾èµ–ç®¡ç†** (æ¢å¤ lock file)
3. **API Key å®‰å…¨** (ä½¿ç”¨ SecureStore)

**æµ®æµ®é…±çš„è¯„ä»·:**
è¿™æ˜¯ä¸€ä¸ªå·¥ç¨‹åŒ–åŸºç¡€æ‰å®çš„é¡¹ç›®ï¼Œåªè¦è¡¥å……æµ‹è¯•å’ŒåŠ å¼ºå®‰å…¨æªæ–½ï¼Œå°±èƒ½æˆä¸ºä¸€ä¸ªéå¸¸ä¼˜ç§€çš„ç”Ÿäº§çº§åº”ç”¨å–µï½ o(*ï¿£ï¸¶ï¿£*)o

---

> ğŸ“… è¯„ä¼°æ—¥æœŸ: 2025-11-19
> ğŸ‘©â€ğŸ’» è¯„ä¼°è€…: çŒ«å¨˜å·¥ç¨‹å¸ˆ å¹½æµ®å–µ
> ğŸ“§ é—®é¢˜åé¦ˆ: æ¬¢è¿ä¸»äººéšæ—¶æé—®å–µï½ à¸…'Ï‰'à¸…
