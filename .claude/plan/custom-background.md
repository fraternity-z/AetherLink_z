# è‡ªå®šä¹‰èƒŒæ™¯åŠŸèƒ½å®æ–½è§„åˆ’æ–‡æ¡£

## å·²æ˜ç¡®çš„å†³ç­–

- **å›¾ç‰‡é€‰æ‹©æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `expo-image-picker` æä¾›åŸç”Ÿå›¾ç‰‡é€‰æ‹©å™¨
- **æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Expo FileSystem API å­˜å‚¨å›¾ç‰‡æ–‡ä»¶ + SQLite å­˜å‚¨é…ç½®è·¯å¾„
- **UI ç»„ä»¶åº“**ï¼šå»¶ç»­ä½¿ç”¨ React Native Paper 5.14.5 ä¿æŒè®¾è®¡ä¸€è‡´æ€§
- **Slider ç»„ä»¶**ï¼šä½¿ç”¨ `@react-native-community/slider ^4.5.4`ï¼ˆå®˜æ–¹æ¨èï¼‰
- **èƒŒæ™¯å›¾ç‰‡å­˜å‚¨ç­–ç•¥**ï¼šä»…ä¿ç•™å½“å‰èƒŒæ™¯ï¼Œæ›¿æ¢æ—¶åˆ é™¤æ—§å›¾ç‰‡
- **èƒŒæ™¯æ•ˆæœ**ï¼šä»…æ”¯æŒä¸é€æ˜åº¦è°ƒæ•´ï¼ˆ0-100%ï¼‰
- **è·¨å¹³å°æ”¯æŒ**ï¼šä»…æ”¯æŒ iOS å’Œ Androidï¼Œä¸æ”¯æŒ Web
- **å­˜å‚¨ä½ç½®**ï¼šæ‰€æœ‰èµ„æºä»…ä¿å­˜åœ¨è®¾å¤‡æœ¬åœ°ï¼Œä¸æ¶‰åŠäº‘ç«¯åŒæ­¥

## æ•´ä½“è§„åˆ’æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡

ä¸º AetherLink_z èŠå¤©åº”ç”¨æ·»åŠ è‡ªå®šä¹‰èƒŒæ™¯åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ï¼š
1. ä»è®¾å¤‡ç›¸å†Œé€‰æ‹©å›¾ç‰‡ä½œä¸ºèŠå¤©é¡µé¢èƒŒæ™¯
2. å®æ—¶è°ƒæ•´èƒŒæ™¯ä¸é€æ˜åº¦ï¼ˆ0-100%ï¼‰
3. é¢„è§ˆèƒŒæ™¯æ•ˆæœå¹¶éšæ—¶é‡ç½®ä¸ºé»˜è®¤
4. æ‰€æœ‰é…ç½®å’Œèµ„æºä»…å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡

**ç”¨æˆ·ä»·å€¼**ï¼š
- ğŸ¨ æä¾›ä¸ªæ€§åŒ–çš„èŠå¤©ä½“éªŒ
- ğŸ‘€ å‡è½»é•¿æ—¶é—´èŠå¤©çš„è§†è§‰ç–²åŠ³
- ğŸ”’ éšç§ä¼˜å…ˆï¼Œæ‰€æœ‰èµ„æºæœ¬åœ°åŒ–å­˜å‚¨
- âš¡ æ— éœ€ç½‘ç»œè¿æ¥å³å¯ä½¿ç”¨è‡ªå®šä¹‰èƒŒæ™¯

### æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**ï¼šReact Native 0.81.5 + Expo 54
- **UI ç»„ä»¶**ï¼šReact Native Paper 5.14.5
- **è·¯ç”±ç³»ç»Ÿ**ï¼šExpo Routerï¼ˆæ–‡ä»¶è·¯ç”±ï¼‰
- **å›¾ç‰‡é€‰æ‹©**ï¼šexpo-image-picker ^16.0.5
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šexpo-file-system ^18.0.6
- **å›¾ç‰‡å¤„ç†**ï¼šexpo-image-manipulator ^12.1.1ï¼ˆç”¨äºå›¾ç‰‡ä¼˜åŒ–ï¼‰
- **æœ¬åœ°å­˜å‚¨**ï¼šExpo SQLiteï¼ˆé…ç½®æŒä¹…åŒ–ï¼‰
- **Slider ç»„ä»¶**ï¼š@react-native-community/slider ^4.5.4
- **çŠ¶æ€ç®¡ç†**ï¼šReact Hooks + Context

### ä¸»è¦é˜¶æ®µ

1. **é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½æ­å»º**ï¼ˆæ•°æ®å±‚ + é…ç½®ç®¡ç†ï¼‰
2. **é˜¶æ®µ 2ï¼šå›¾ç‰‡é€‰æ‹©ä¸å­˜å‚¨**ï¼ˆæ–‡ä»¶ç³»ç»Ÿé›†æˆï¼‰
3. **é˜¶æ®µ 3ï¼šUI å®ç°**ï¼ˆè®¾ç½®é¡µé¢ + ä¸»èŠå¤©é¡µé¢èƒŒæ™¯æ¸²æŸ“ï¼‰
4. **é˜¶æ®µ 4ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯•**ï¼ˆè·¨å¹³å°éªŒè¯ + æ€§èƒ½è°ƒä¼˜ï¼‰

---

## è¯¦ç»†ä»»åŠ¡åˆ†è§£

### é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½æ­å»º

#### ä»»åŠ¡ 1.1ï¼šæ•°æ®åº“ Schema æ‰©å±•

**ç›®æ ‡**ï¼šåœ¨ settings è¡¨ä¸­æ·»åŠ èƒŒæ™¯é…ç½®å­—æ®µ

**è¾“å…¥**ï¼š
- å½“å‰æ•°æ®åº“ç»“æ„ï¼ˆ`storage/sqlite/migrations/`ï¼‰
- è®¾ç½®æ•°æ®æ¨¡å‹ï¼ˆ`storage/repositories/settings.ts`ï¼‰

**è¾“å‡º**ï¼š
- æ–°å¢æ•°æ®åº“è¿ç§»æ–‡ä»¶
- æ›´æ–° TypeScript ç±»å‹å®šä¹‰

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
storage/sqlite/migrations/000X_add_background_settings.ts
storage/core.tsï¼ˆæ–°å¢ BackgroundSettings ç±»å‹ï¼‰
storage/repositories/settings.tsï¼ˆæ‰©å±• CRUD æ–¹æ³•ï¼‰
```

**å…·ä½“å®ç°**ï¼š

**æ–¹æ¡ˆï¼šæ‰©å±• settings è¡¨**ï¼ˆæ¨èï¼Œä¸ç°æœ‰è®¾ç½®æ¨¡å¼ä¸€è‡´ï¼‰

```typescript
// storage/sqlite/migrations/000X_add_background_settings.ts
import { SQLiteDatabase } from 'expo-sqlite';

export async function up(db: SQLiteDatabase): Promise<void> {
  await db.execAsync(`
    -- æ·»åŠ èƒŒæ™¯ç›¸å…³å­—æ®µåˆ° settings è¡¨
    ALTER TABLE settings ADD COLUMN background_image_path TEXT DEFAULT NULL;
    ALTER TABLE settings ADD COLUMN background_opacity REAL DEFAULT 0.3;
    ALTER TABLE settings ADD COLUMN background_enabled INTEGER DEFAULT 0;
  `);
}

export async function down(db: SQLiteDatabase): Promise<void> {
  // SQLite ä¸æ”¯æŒ DROP COLUMNï¼Œéœ€è¦é‡å»ºè¡¨ï¼ˆä»…å¼€å‘ç¯å¢ƒä½¿ç”¨ï¼‰
  // ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®æ‰§è¡Œå›æ»šæ“ä½œ
}
```

**TypeScript ç±»å‹å®šä¹‰**ï¼š

```typescript
// storage/core.ts
export interface BackgroundSettings {
  imagePath: string | null;      // æœ¬åœ°æ–‡ä»¶è·¯å¾„
  opacity: number;                // ä¸é€æ˜åº¦ (0.0-1.0)
  enabled: boolean;               // æ˜¯å¦å¯ç”¨
}

// æ‰©å±•ç°æœ‰çš„ Settings æ¥å£
export interface Settings {
  // ... ç°æœ‰å­—æ®µ
  backgroundImagePath?: string | null;
  backgroundOpacity?: number;
  backgroundEnabled?: boolean;
}
```

**Repository å±‚æ‰©å±•**ï¼š

```typescript
// storage/repositories/settings.ts
export async function getBackgroundSettings(): Promise<BackgroundSettings> {
  const db = await getDatabase();
  const result = await db.getFirstAsync<{
    background_image_path: string | null;
    background_opacity: number;
    background_enabled: number;
  }>(`
    SELECT
      background_image_path,
      background_opacity,
      background_enabled
    FROM settings
    LIMIT 1
  `);

  return {
    imagePath: result?.background_image_path ?? null,
    opacity: result?.background_opacity ?? 0.3,
    enabled: Boolean(result?.background_enabled ?? 0),
  };
}

export async function updateBackgroundSettings(
  settings: Partial<BackgroundSettings>
): Promise<void> {
  const db = await getDatabase();
  const updates: string[] = [];
  const values: any[] = [];

  if (settings.imagePath !== undefined) {
    updates.push('background_image_path = ?');
    values.push(settings.imagePath);
  }
  if (settings.opacity !== undefined) {
    updates.push('background_opacity = ?');
    values.push(settings.opacity);
  }
  if (settings.enabled !== undefined) {
    updates.push('background_enabled = ?');
    values.push(settings.enabled ? 1 : 0);
  }

  if (updates.length > 0) {
    await db.runAsync(
      `UPDATE settings SET ${updates.join(', ')}`,
      ...values
    );
  }
}
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š2 å°æ—¶

---

#### ä»»åŠ¡ 1.2ï¼šåˆ›å»ºèƒŒæ™¯é…ç½®ç®¡ç† Hook

**ç›®æ ‡**ï¼šå°è£…èƒŒæ™¯è®¾ç½®çš„è¯»å†™é€»è¾‘ï¼Œæä¾›ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†æ¥å£

**è¾“å…¥**ï¼š
- æ•°æ®åº“ Repository å±‚
- ç°æœ‰ Settings Hook å‚è€ƒï¼ˆ`hooks/use-setting.ts`ï¼‰

**è¾“å‡º**ï¼š
- `hooks/use-background-settings.ts`

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
hooks/use-background-settings.tsï¼ˆæ–°å»ºï¼‰
storage/repositories/settings.tsï¼ˆå·²åœ¨ä»»åŠ¡ 1.1 æ‰©å±•ï¼‰
```

**æ¥å£è®¾è®¡**ï¼š

```typescript
// hooks/use-background-settings.ts
import { useState, useEffect, useCallback } from 'react';
import {
  getBackgroundSettings,
  updateBackgroundSettings,
} from '@/storage/repositories/settings';
import { BackgroundSettings } from '@/storage/core';
import { logger } from '@/utils/logger';

export function useBackgroundSettings() {
  const [settings, setSettings] = useState<BackgroundSettings>({
    imagePath: null,
    opacity: 0.3,
    enabled: false,
  });
  const [isLoading, setIsLoading] = useState(true);

  // åˆå§‹åŒ–åŠ è½½è®¾ç½®
  useEffect(() => {
    loadSettings();
  }, []);

  const loadSettings = async () => {
    try {
      setIsLoading(true);
      const data = await getBackgroundSettings();
      setSettings(data);
    } catch (error) {
      logger.error('Failed to load background settings', { error });
    } finally {
      setIsLoading(false);
    }
  };

  // æ›´æ–°å›¾ç‰‡è·¯å¾„
  const updateImagePath = useCallback(async (path: string | null) => {
    try {
      await updateBackgroundSettings({ imagePath: path });
      setSettings((prev) => ({ ...prev, imagePath: path }));
    } catch (error) {
      logger.error('Failed to update background image path', { error });
      throw error;
    }
  }, []);

  // æ›´æ–°ä¸é€æ˜åº¦
  const updateOpacity = useCallback(async (opacity: number) => {
    // ç¡®ä¿å€¼åœ¨ 0.0-1.0 èŒƒå›´å†…
    const clampedOpacity = Math.max(0, Math.min(1, opacity));
    try {
      await updateBackgroundSettings({ opacity: clampedOpacity });
      setSettings((prev) => ({ ...prev, opacity: clampedOpacity }));
    } catch (error) {
      logger.error('Failed to update background opacity', { error });
      throw error;
    }
  }, []);

  // åˆ‡æ¢å¯ç”¨çŠ¶æ€
  const toggleEnabled = useCallback(async (enabled: boolean) => {
    try {
      await updateBackgroundSettings({ enabled });
      setSettings((prev) => ({ ...prev, enabled }));
    } catch (error) {
      logger.error('Failed to toggle background enabled', { error });
      throw error;
    }
  }, []);

  // é‡ç½®ä¸ºé»˜è®¤è®¾ç½®
  const reset = useCallback(async () => {
    try {
      await updateBackgroundSettings({
        imagePath: null,
        opacity: 0.3,
        enabled: false,
      });
      setSettings({
        imagePath: null,
        opacity: 0.3,
        enabled: false,
      });
    } catch (error) {
      logger.error('Failed to reset background settings', { error });
      throw error;
    }
  }, []);

  return {
    settings,
    updateImagePath,
    updateOpacity,
    toggleEnabled,
    reset,
    isLoading,
    refresh: loadSettings, // æä¾›æ‰‹åŠ¨åˆ·æ–°æ–¹æ³•
  };
}
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š3 å°æ—¶

---

### é˜¶æ®µ 2ï¼šå›¾ç‰‡é€‰æ‹©ä¸å­˜å‚¨

#### ä»»åŠ¡ 2.1ï¼šé›†æˆå›¾ç‰‡é€‰æ‹©å™¨

**ç›®æ ‡**ï¼šå…è®¸ç”¨æˆ·ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡ï¼ˆä»… iOS å’Œ Androidï¼‰

**è¾“å…¥**ï¼š
- Expo Image Picker API
- å½“å‰æƒé™ç®¡ç†é€»è¾‘

**è¾“å‡º**ï¼š
- å›¾ç‰‡é€‰æ‹©æœåŠ¡æ¨¡å—

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
services/media/ImagePicker.tsï¼ˆæ–°å»ºï¼‰
app.jsonï¼ˆé…ç½®æƒé™ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š

```typescript
// services/media/ImagePicker.ts
import * as ImagePicker from 'expo-image-picker';
import { Alert, Linking, Platform } from 'react-native';
import { logger } from '@/utils/logger';

/**
 * æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨ï¼Œå…è®¸ç”¨æˆ·ä»ç›¸å†Œé€‰æ‹©èƒŒæ™¯å›¾ç‰‡
 * @returns é€‰æ‹©çš„å›¾ç‰‡ URIï¼Œå¦‚æœå–æ¶ˆåˆ™è¿”å› null
 */
export async function selectBackgroundImage(): Promise<string | null> {
  try {
    // 1. è¯·æ±‚æƒé™
    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();

    if (status !== 'granted') {
      handlePermissionDenied();
      return null;
    }

    // 2. æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images,
      allowsEditing: true,
      aspect: [9, 16],  // å»ºè®®ç«–å±æ¯”ä¾‹
      quality: 0.8,     // åˆæ­¥å‹ç¼©è´¨é‡
    });

    if (result.canceled) {
      logger.debug('User cancelled image picker');
      return null;
    }

    const uri = result.assets[0].uri;
    logger.info('Image selected', { uri });
    return uri;

  } catch (error) {
    logger.error('Failed to select background image', { error });
    Alert.alert('é€‰æ‹©å¤±è´¥', 'æ— æ³•æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨ï¼Œè¯·ç¨åé‡è¯•');
    return null;
  }
}

/**
 * å¤„ç†æƒé™è¢«æ‹’ç»çš„æƒ…å†µ
 */
function handlePermissionDenied(): void {
  Alert.alert(
    'éœ€è¦ç›¸å†Œæƒé™',
    'è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸ AetherLink è®¿é—®ç›¸å†Œä»¥é€‰æ‹©èƒŒæ™¯å›¾ç‰‡',
    [
      { text: 'å–æ¶ˆ', style: 'cancel' },
      {
        text: 'å»è®¾ç½®',
        onPress: () => {
          if (Platform.OS === 'ios') {
            Linking.openURL('app-settings:');
          } else {
            Linking.openSettings();
          }
        },
      },
    ]
  );
}
```

**æƒé™é…ç½®**ï¼ˆapp.jsonï¼‰ï¼š

```json
{
  "expo": {
    "plugins": [
      [
        "expo-image-picker",
        {
          "photosPermission": "å…è®¸ AetherLink è®¿é—®æ‚¨çš„ç›¸å†Œä»¥é€‰æ‹©èŠå¤©èƒŒæ™¯å›¾ç‰‡"
        }
      ]
    ]
  }
}
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š2 å°æ—¶

---

#### ä»»åŠ¡ 2.2ï¼šå›¾ç‰‡ä¼˜åŒ–ä¸æœ¬åœ°å­˜å‚¨

**ç›®æ ‡**ï¼šå‹ç¼©å›¾ç‰‡å¹¶ä¿å­˜åˆ°åº”ç”¨ç§æœ‰ç›®å½•ï¼Œæ›¿æ¢æ—¶åˆ é™¤æ—§å›¾ç‰‡

**è¾“å…¥**ï¼š
- ç”¨æˆ·é€‰æ‹©çš„åŸå§‹å›¾ç‰‡ URI
- Expo FileSystem API
- Expo Image Manipulator API

**è¾“å‡º**ï¼š
- ä¼˜åŒ–åçš„æœ¬åœ°å›¾ç‰‡è·¯å¾„

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
services/media/ImageStorage.tsï¼ˆæ–°å»ºï¼‰
constants/app-config.tsï¼ˆæ–°å¢æ–‡ä»¶è·¯å¾„å¸¸é‡ï¼‰
```

**å®ç°é€»è¾‘**ï¼š

```typescript
// services/media/ImageStorage.ts
import * as FileSystem from 'expo-file-system';
import * as ImageManipulator from 'expo-image-manipulator';
import { logger } from '@/utils/logger';

const BACKGROUND_DIR = `${FileSystem.documentDirectory}backgrounds/`;
const CURRENT_BACKGROUND_FILENAME = 'current_background.jpg';

/**
 * ä¿å­˜èƒŒæ™¯å›¾ç‰‡åˆ°æœ¬åœ°å­˜å‚¨
 * æ³¨æ„ï¼šä¼šè‡ªåŠ¨åˆ é™¤æ—§èƒŒæ™¯å›¾ç‰‡ï¼Œä»…ä¿ç•™å½“å‰èƒŒæ™¯
 *
 * @param uri - åŸå§‹å›¾ç‰‡ URI
 * @returns ä¿å­˜åçš„æœ¬åœ°æ–‡ä»¶è·¯å¾„
 */
export async function saveBackgroundImage(uri: string): Promise<string> {
  try {
    // 1. ç¡®ä¿ç›®å½•å­˜åœ¨
    await ensureDirectoryExists();

    // 2. åˆ é™¤æ—§èƒŒæ™¯å›¾ç‰‡
    await deleteOldBackground();

    // 3. å›¾ç‰‡ä¼˜åŒ–ï¼ˆå‹ç¼© + ç¼©æ”¾ï¼‰
    logger.debug('Optimizing background image', { uri });
    const manipResult = await ImageManipulator.manipulateAsync(
      uri,
      [{ resize: { width: 1080 } }], // é™åˆ¶å®½åº¦ï¼Œä¿æŒå®½é«˜æ¯”
      { compress: 0.7, format: ImageManipulator.SaveFormat.JPEG }
    );

    // 4. ä¿å­˜åˆ°å›ºå®šè·¯å¾„ï¼ˆè¦†ç›–æ—§æ–‡ä»¶ï¼‰
    const destPath = `${BACKGROUND_DIR}${CURRENT_BACKGROUND_FILENAME}`;
    await FileSystem.moveAsync({
      from: manipResult.uri,
      to: destPath,
    });

    // 5. éªŒè¯æ–‡ä»¶å¤§å°
    const fileInfo = await FileSystem.getInfoAsync(destPath);
    if (!fileInfo.exists) {
      throw new Error('Failed to save background image');
    }

    const fileSizeMB = fileInfo.size / 1024 / 1024;
    logger.info('Background image saved', {
      path: destPath,
      size: `${fileSizeMB.toFixed(2)} MB`,
    });

    return destPath;

  } catch (error) {
    logger.error('Failed to save background image', { error });
    throw error;
  }
}

/**
 * åˆ é™¤å½“å‰èƒŒæ™¯å›¾ç‰‡
 * ç”¨äºé‡ç½®èƒŒæ™¯æˆ–æ›´æ¢å›¾ç‰‡æ—¶æ¸…ç†å­˜å‚¨
 */
export async function deleteBackgroundImage(path?: string): Promise<void> {
  try {
    const targetPath = path ?? `${BACKGROUND_DIR}${CURRENT_BACKGROUND_FILENAME}`;
    const fileInfo = await FileSystem.getInfoAsync(targetPath);

    if (fileInfo.exists) {
      await FileSystem.deleteAsync(targetPath);
      logger.info('Background image deleted', { path: targetPath });
    }
  } catch (error) {
    logger.error('Failed to delete background image', { error });
    // ä¸æŠ›å‡ºé”™è¯¯ï¼Œé¿å…å½±å“åç»­æ“ä½œ
  }
}

/**
 * åˆ é™¤æ—§èƒŒæ™¯å›¾ç‰‡ï¼ˆå†…éƒ¨æ–¹æ³•ï¼‰
 */
async function deleteOldBackground(): Promise<void> {
  const oldPath = `${BACKGROUND_DIR}${CURRENT_BACKGROUND_FILENAME}`;
  await deleteBackgroundImage(oldPath);
}

/**
 * ç¡®ä¿èƒŒæ™¯å›¾ç‰‡ç›®å½•å­˜åœ¨
 */
async function ensureDirectoryExists(): Promise<void> {
  const dirInfo = await FileSystem.getInfoAsync(BACKGROUND_DIR);
  if (!dirInfo.exists) {
    await FileSystem.makeDirectoryAsync(BACKGROUND_DIR, { intermediates: true });
    logger.debug('Background directory created', { path: BACKGROUND_DIR });
  }
}

/**
 * æ£€æŸ¥å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³
 * @param requiredMB - æ‰€éœ€ç©ºé—´ï¼ˆMBï¼‰
 * @returns ç©ºé—´æ˜¯å¦å……è¶³
 */
export async function checkStorageSpace(requiredMB: number = 10): Promise<boolean> {
  try {
    const freeSpace = await FileSystem.getFreeDiskStorageAsync();
    const freeSpaceMB = freeSpace / 1024 / 1024;

    logger.debug('Storage space check', {
      free: `${freeSpaceMB.toFixed(2)} MB`,
      required: `${requiredMB} MB`,
    });

    return freeSpaceMB >= requiredMB;
  } catch (error) {
    logger.error('Failed to check storage space', { error });
    return true; // é»˜è®¤è®¤ä¸ºç©ºé—´å……è¶³ï¼Œé¿å…é˜»å¡ç”¨æˆ·æ“ä½œ
  }
}
```

**å¸¸é‡é…ç½®**ï¼š

```typescript
// constants/app-config.ts
export const STORAGE_CONFIG = {
  BACKGROUND_DIR: `${FileSystem.documentDirectory}backgrounds/`,
  MAX_IMAGE_WIDTH: 1080,           // æœ€å¤§å®½åº¦ï¼ˆpxï¼‰
  JPEG_QUALITY: 0.7,               // JPEG å‹ç¼©ç‡
  MAX_FILE_SIZE_MB: 10,            // æœ€å¤§æ–‡ä»¶å¤§å°ï¼ˆMBï¼‰
  MIN_FREE_SPACE_MB: 50,           // æœ€å°å‰©ä½™ç©ºé—´ï¼ˆMBï¼‰
};
```

**æ€§èƒ½ä¼˜åŒ–è€ƒè™‘**ï¼š
- å›¾ç‰‡å®½åº¦é™åˆ¶ä¸º 1080pxï¼ˆå¹³è¡¡è´¨é‡ä¸æ€§èƒ½ï¼‰
- JPEG å‹ç¼©ç‡ 70%ï¼ˆå‡å°æ–‡ä»¶å¤§å°ï¼‰
- **ä»…ä¿ç•™å½“å‰èƒŒæ™¯ï¼Œæ›¿æ¢æ—¶è‡ªåŠ¨åˆ é™¤æ—§æ–‡ä»¶**
- å›ºå®šæ–‡ä»¶åé¿å…æ–‡ä»¶å †ç§¯

**é¢„ä¼°å·¥ä½œé‡**ï¼š4 å°æ—¶

---

### é˜¶æ®µ 3ï¼šUI å®ç°

#### ä»»åŠ¡ 3.1ï¼šå¤–è§‚è®¾ç½®é¡µé¢æ‰©å±•

**ç›®æ ‡**ï¼šåœ¨ `app/settings/appearance.tsx` æ·»åŠ èƒŒæ™¯é…ç½® UI

**è¾“å…¥**ï¼š
- ç°æœ‰å¤–è§‚è®¾ç½®é¡µé¢
- useBackgroundSettings Hook
- React Native Paper ç»„ä»¶
- @react-native-community/slider ç»„ä»¶

**è¾“å‡º**ï¼š
- èƒŒæ™¯å›¾ç‰‡é€‰æ‹©å™¨
- ä¸é€æ˜åº¦æ»‘å—
- å¯ç”¨å¼€å…³
- é¢„è§ˆå’Œé‡ç½®æŒ‰é’®

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
app/settings/appearance.tsxï¼ˆä¿®æ”¹ï¼‰
components/settings/BackgroundPreview.tsxï¼ˆæ–°å»ºï¼‰
package.jsonï¼ˆæ–°å¢ @react-native-community/slider ä¾èµ–ï¼‰
```

**UI å¸ƒå±€ç»“æ„**ï¼š

```tsx
// app/settings/appearance.tsx
import React, { useState } from 'react';
import { ScrollView, StyleSheet, View, Alert } from 'react-native';
import { List, Switch, Button, ActivityIndicator } from 'react-native-paper';
import Slider from '@react-native-community/slider';
import { useBackgroundSettings } from '@/hooks/use-background-settings';
import { selectBackgroundImage } from '@/services/media/ImagePicker';
import {
  saveBackgroundImage,
  deleteBackgroundImage,
  checkStorageSpace,
} from '@/services/media/ImageStorage';
import { BackgroundPreview } from '@/components/settings/BackgroundPreview';
import { useConfirmDialog } from '@/hooks/use-confirm-dialog';
import { logger } from '@/utils/logger';

export default function AppearanceSettings() {
  const {
    settings,
    updateImagePath,
    updateOpacity,
    toggleEnabled,
    reset,
    isLoading,
  } = useBackgroundSettings();
  const [isSaving, setIsSaving] = useState(false);
  const { confirm } = useConfirmDialog();

  /**
   * å¤„ç†å›¾ç‰‡é€‰æ‹©
   */
  const handleSelectImage = async () => {
    try {
      // 1. æ£€æŸ¥å­˜å‚¨ç©ºé—´
      const hasSpace = await checkStorageSpace(10);
      if (!hasSpace) {
        Alert.alert('å­˜å‚¨ç©ºé—´ä¸è¶³', 'è¯·æ¸…ç†è®¾å¤‡å­˜å‚¨åé‡è¯•ï¼ˆå»ºè®®ä¿ç•™è‡³å°‘ 50MB ç©ºé—´ï¼‰');
        return;
      }

      // 2. æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨
      const uri = await selectBackgroundImage();
      if (!uri) {
        return;
      }

      // 3. ä¿å­˜å›¾ç‰‡
      setIsSaving(true);
      const newPath = await saveBackgroundImage(uri);
      await updateImagePath(newPath);

      // 4. è‡ªåŠ¨å¯ç”¨èƒŒæ™¯
      if (!settings.enabled) {
        await toggleEnabled(true);
      }

      Alert.alert('æˆåŠŸ', 'èƒŒæ™¯å›¾ç‰‡å·²æ›´æ–°');

    } catch (error) {
      logger.error('Failed to save background image', { error });
      Alert.alert('ä¿å­˜å¤±è´¥', 'æ— æ³•ä¿å­˜èƒŒæ™¯å›¾ç‰‡ï¼Œè¯·ç¨åé‡è¯•');
    } finally {
      setIsSaving(false);
    }
  };

  /**
   * å¤„ç†ä¸é€æ˜åº¦å˜åŒ–
   */
  const handleOpacityChange = async (value: number) => {
    try {
      await updateOpacity(value);
    } catch (error) {
      logger.error('Failed to update opacity', { error });
    }
  };

  /**
   * å¤„ç†é‡ç½®èƒŒæ™¯
   */
  const handleReset = async () => {
    const confirmed = await confirm({
      title: 'é‡ç½®èƒŒæ™¯',
      message: 'ç¡®å®šè¦æ¢å¤é»˜è®¤èƒŒæ™¯å—ï¼Ÿæ­¤æ“ä½œå°†åˆ é™¤å½“å‰èƒŒæ™¯å›¾ç‰‡ã€‚',
    });

    if (!confirmed) {
      return;
    }

    try {
      // åˆ é™¤å›¾ç‰‡æ–‡ä»¶
      if (settings.imagePath) {
        await deleteBackgroundImage(settings.imagePath);
      }

      // é‡ç½®è®¾ç½®
      await reset();

      Alert.alert('æˆåŠŸ', 'å·²æ¢å¤é»˜è®¤èƒŒæ™¯');
    } catch (error) {
      logger.error('Failed to reset background', { error });
      Alert.alert('é‡ç½®å¤±è´¥', 'æ— æ³•é‡ç½®èƒŒæ™¯ï¼Œè¯·ç¨åé‡è¯•');
    }
  };

  if (isLoading) {
    return (
      <View style={styles.loadingContainer}>
        <ActivityIndicator size="large" />
      </View>
    );
  }

  return (
    <ScrollView style={styles.container}>
      {/* ç°æœ‰ä¸»é¢˜è®¾ç½®... */}

      <List.Section>
        <List.Subheader>èŠå¤©èƒŒæ™¯</List.Subheader>

        {/* å¯ç”¨å¼€å…³ */}
        <List.Item
          title="è‡ªå®šä¹‰èƒŒæ™¯"
          description="ä¸ºèŠå¤©é¡µé¢è®¾ç½®ä¸ªæ€§åŒ–èƒŒæ™¯å›¾ç‰‡"
          right={() => (
            <Switch
              value={settings.enabled}
              onValueChange={toggleEnabled}
              disabled={!settings.imagePath} // æœªé€‰æ‹©å›¾ç‰‡æ—¶ç¦ç”¨
            />
          )}
        />

        {/* å›¾ç‰‡é€‰æ‹©æŒ‰é’® */}
        <View style={styles.buttonContainer}>
          <Button
            mode="outlined"
            icon="image-plus"
            onPress={handleSelectImage}
            loading={isSaving}
            disabled={isSaving}
            style={styles.button}
          >
            {settings.imagePath ? 'æ›´æ¢èƒŒæ™¯å›¾ç‰‡' : 'é€‰æ‹©èƒŒæ™¯å›¾ç‰‡'}
          </Button>
        </View>

        {/* èƒŒæ™¯é¢„è§ˆ */}
        {settings.imagePath && (
          <BackgroundPreview
            imagePath={settings.imagePath}
            opacity={settings.opacity}
          />
        )}

        {/* ä¸é€æ˜åº¦æ»‘å— */}
        {settings.imagePath && (
          <>
            <List.Item
              title={`ä¸é€æ˜åº¦ï¼š${Math.round(settings.opacity * 100)}%`}
              description="è°ƒæ•´èƒŒæ™¯å›¾ç‰‡çš„é€æ˜ç¨‹åº¦"
            />
            <View style={styles.sliderContainer}>
              <Slider
                value={settings.opacity}
                onValueChange={handleOpacityChange}
                minimumValue={0.1}
                maximumValue={1.0}
                step={0.05}
                minimumTrackTintColor="#6200ee"
                maximumTrackTintColor="#cccccc"
                thumbTintColor="#6200ee"
                style={styles.slider}
              />
            </View>
          </>
        )}

        {/* é‡ç½®æŒ‰é’® */}
        {settings.imagePath && (
          <View style={styles.buttonContainer}>
            <Button
              mode="text"
              icon="restore"
              onPress={handleReset}
              style={styles.button}
            >
              æ¢å¤é»˜è®¤èƒŒæ™¯
            </Button>
          </View>
        )}

        {/* ä½¿ç”¨æç¤º */}
        <List.Item
          title="ğŸ’¡ ä½¿ç”¨æç¤º"
          description="å»ºè®®é€‰æ‹©è‰²å½©æŸ”å’Œçš„å›¾ç‰‡ï¼Œé¿å…å½±å“èŠå¤©å†…å®¹çš„å¯è¯»æ€§"
          descriptionNumberOfLines={3}
        />
      </List.Section>
    </ScrollView>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  loadingContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  buttonContainer: {
    paddingHorizontal: 16,
    paddingVertical: 8,
  },
  button: {
    marginVertical: 4,
  },
  sliderContainer: {
    paddingHorizontal: 24,
    paddingVertical: 8,
  },
  slider: {
    width: '100%',
    height: 40,
  },
});
```

**ä¾èµ–å®‰è£…**ï¼š

```bash
npm install @react-native-community/slider@^4.5.4
```

**package.json æ›´æ–°**ï¼š

```json
{
  "dependencies": {
    "@react-native-community/slider": "^4.5.4"
  }
}
```

**Slider ç»„ä»¶ä½¿ç”¨è¯´æ˜**ï¼š

```tsx
import Slider from '@react-native-community/slider';

<Slider
  value={settings.opacity}              // å½“å‰å€¼
  onValueChange={handleOpacityChange}   // å®æ—¶å›è°ƒ
  minimumValue={0.1}                    // æœ€å°å€¼ï¼ˆ10%ï¼‰
  maximumValue={1.0}                    // æœ€å¤§å€¼ï¼ˆ100%ï¼‰
  step={0.05}                           // æ­¥è¿›ï¼ˆ5%ï¼‰
  minimumTrackTintColor="#6200ee"       // å·¦ä¾§è½¨é“é¢œè‰²ï¼ˆMaterial Purpleï¼‰
  maximumTrackTintColor="#cccccc"       // å³ä¾§è½¨é“é¢œè‰²
  thumbTintColor="#6200ee"              // æ»‘å—é¢œè‰²
  style={styles.slider}
/>
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š5 å°æ—¶

---

#### ä»»åŠ¡ 3.2ï¼šä¸»èŠå¤©é¡µé¢èƒŒæ™¯æ¸²æŸ“

**ç›®æ ‡**ï¼šåœ¨ `app/index.tsx` æ¸²æŸ“è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡

**è¾“å…¥**ï¼š
- useBackgroundSettings Hook
- ç°æœ‰èŠå¤©é¡µé¢ç»“æ„

**è¾“å‡º**ï¼š
- èƒŒæ™¯å›¾ç‰‡å±‚ï¼ˆæœ€åº•å±‚ï¼‰
- ä¸ç°æœ‰ç»„ä»¶çš„å±‚çº§åè°ƒ

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
app/index.tsxï¼ˆä¿®æ”¹ï¼‰
components/chat/ChatBackground.tsxï¼ˆæ–°å»ºï¼‰
```

**å®ç°æ–¹æ¡ˆï¼šä½¿ç”¨ ImageBackground ç»„ä»¶**ï¼ˆæ¨èï¼‰

```tsx
// components/chat/ChatBackground.tsx
import React, { useState } from 'react';
import { ImageBackground, StyleSheet, View, Alert } from 'react-native';
import { ActivityIndicator } from 'react-native-paper';
import { useBackgroundSettings } from '@/hooks/use-background-settings';
import { logger } from '@/utils/logger';

interface ChatBackgroundProps {
  children: React.ReactNode;
}

/**
 * èŠå¤©èƒŒæ™¯ç»„ä»¶
 * æ ¹æ®ç”¨æˆ·è®¾ç½®æ¸²æŸ“è‡ªå®šä¹‰èƒŒæ™¯å›¾ç‰‡
 */
export function ChatBackground({ children }: ChatBackgroundProps) {
  const { settings, updateImagePath } = useBackgroundSettings();
  const [isLoading, setIsLoading] = useState(false);

  /**
   * å¤„ç†å›¾ç‰‡åŠ è½½å¤±è´¥
   */
  const handleImageError = () => {
    logger.error('Failed to load background image', {
      path: settings.imagePath,
    });

    // ç¦ç”¨èƒŒæ™¯å¹¶æç¤ºç”¨æˆ·
    Alert.alert(
      'èƒŒæ™¯åŠ è½½å¤±è´¥',
      'æ— æ³•åŠ è½½èƒŒæ™¯å›¾ç‰‡ï¼Œå·²æ¢å¤é»˜è®¤èƒŒæ™¯',
      [
        {
          text: 'ç¡®å®š',
          onPress: async () => {
            try {
              await updateImagePath(null);
            } catch (error) {
              logger.error('Failed to reset background', { error });
            }
          },
        },
      ]
    );
  };

  /**
   * å¤„ç†å›¾ç‰‡åŠ è½½å¼€å§‹
   */
  const handleLoadStart = () => {
    setIsLoading(true);
  };

  /**
   * å¤„ç†å›¾ç‰‡åŠ è½½å®Œæˆ
   */
  const handleLoadEnd = () => {
    setIsLoading(false);
  };

  // æœªå¯ç”¨æˆ–æ— å›¾ç‰‡è·¯å¾„æ—¶ï¼Œç›´æ¥æ¸²æŸ“å­ç»„ä»¶
  if (!settings.enabled || !settings.imagePath) {
    return <>{children}</>;
  }

  return (
    <ImageBackground
      source={{ uri: settings.imagePath }}
      style={styles.background}
      imageStyle={[styles.backgroundImage, { opacity: settings.opacity }]}
      resizeMode="cover"
      onError={handleImageError}
      onLoadStart={handleLoadStart}
      onLoadEnd={handleLoadEnd}
    >
      {isLoading && (
        <View style={styles.loadingOverlay}>
          <ActivityIndicator size="large" />
        </View>
      )}
      {children}
    </ImageBackground>
  );
}

const styles = StyleSheet.create({
  background: {
    flex: 1,
  },
  backgroundImage: {
    // opacity é€šè¿‡ props åŠ¨æ€è®¾ç½®
  },
  loadingOverlay: {
    position: 'absolute',
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(255, 255, 255, 0.8)',
    zIndex: 1000,
  },
});
```

**é›†æˆåˆ°ä¸»èŠå¤©é¡µé¢**ï¼š

```tsx
// app/index.tsx
import React from 'react';
import { SafeAreaView, StyleSheet } from 'react-native';
import { MessageList } from '@/components/chat/MessageList';
import { ChatInput } from '@/components/chat/ChatInput';
import { ChatBackground } from '@/components/chat/ChatBackground';

export default function ChatScreen() {
  return (
    <ChatBackground>
      <SafeAreaView style={styles.container}>
        <MessageList />
        <ChatInput />
      </SafeAreaView>
    </ChatBackground>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
});
```

**ä¼˜ç‚¹**ï¼š
- ä»£ç ç®€æ´ï¼Œæ˜“äºç»´æŠ¤
- è‡ªåŠ¨å¤„ç†å›¾ç‰‡åŠ è½½å’Œç¼“å­˜
- æ€§èƒ½è¾ƒå¥½ï¼Œåˆ©ç”¨åŸç”Ÿ ImageBackground ç»„ä»¶
- ä¸é€æ˜åº¦é€šè¿‡ imageStyle è®¾ç½®ï¼Œä¸å½±å“å­ç»„ä»¶

**é¢„ä¼°å·¥ä½œé‡**ï¼š3 å°æ—¶

---

#### ä»»åŠ¡ 3.3ï¼šèƒŒæ™¯é¢„è§ˆç»„ä»¶

**ç›®æ ‡**ï¼šåœ¨è®¾ç½®é¡µé¢æä¾›å®æ—¶é¢„è§ˆæ•ˆæœ

**è¾“å…¥**ï¼š
- å½“å‰èƒŒæ™¯è®¾ç½®
- æ¨¡æ‹ŸèŠå¤©æ°”æ³¡

**è¾“å‡º**ï¼š
- å¯äº¤äº’çš„é¢„è§ˆç»„ä»¶

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
components/settings/BackgroundPreview.tsxï¼ˆæ–°å»ºï¼‰
```

**å®ç°ç¤ºä¾‹**ï¼š

```tsx
// components/settings/BackgroundPreview.tsx
import React from 'react';
import { Image, View, StyleSheet } from 'react-native';
import { Card, Text, useTheme } from 'react-native-paper';

interface BackgroundPreviewProps {
  imagePath: string;
  opacity: number;
}

/**
 * èƒŒæ™¯é¢„è§ˆç»„ä»¶
 * åœ¨è®¾ç½®é¡µé¢å±•ç¤ºèƒŒæ™¯æ•ˆæœçš„å®æ—¶é¢„è§ˆ
 */
export function BackgroundPreview({ imagePath, opacity }: BackgroundPreviewProps) {
  const theme = useTheme();

  return (
    <Card style={styles.previewCard}>
      {/* èƒŒæ™¯å›¾ç‰‡å±‚ */}
      <Image
        source={{ uri: imagePath }}
        style={[styles.backgroundImage, { opacity }]}
        resizeMode="cover"
      />

      {/* æ¨¡æ‹ŸèŠå¤©æ°”æ³¡ */}
      <View style={styles.mockChat}>
        <Card
          style={[
            styles.userBubble,
            { backgroundColor: theme.colors.primaryContainer },
          ]}
        >
          <Card.Content>
            <Text
              variant="bodyMedium"
              style={{ color: theme.colors.onPrimaryContainer }}
            >
              è¿™æ˜¯é¢„è§ˆæ•ˆæœ
            </Text>
          </Card.Content>
        </Card>

        <Card
          style={[
            styles.aiBubble,
            { backgroundColor: theme.colors.secondaryContainer },
          ]}
        >
          <Card.Content>
            <Text
              variant="bodyMedium"
              style={{ color: theme.colors.onSecondaryContainer }}
            >
              èƒŒæ™¯çœ‹èµ·æ¥ä¸é”™ï¼
            </Text>
          </Card.Content>
        </Card>
      </View>

      {/* æç¤ºæ–‡å­— */}
      <View style={styles.hintContainer}>
        <Text variant="labelSmall" style={styles.hintText}>
          â†‘ å®æ—¶é¢„è§ˆæ•ˆæœ
        </Text>
      </View>
    </Card>
  );
}

const styles = StyleSheet.create({
  previewCard: {
    height: 200,
    margin: 16,
    overflow: 'hidden',
    borderRadius: 12,
    elevation: 2,
  },
  backgroundImage: {
    position: 'absolute',
    width: '100%',
    height: '100%',
  },
  mockChat: {
    flex: 1,
    justifyContent: 'center',
    padding: 16,
  },
  userBubble: {
    alignSelf: 'flex-end',
    maxWidth: '70%',
    marginBottom: 8,
    borderRadius: 16,
    borderTopRightRadius: 4,
  },
  aiBubble: {
    alignSelf: 'flex-start',
    maxWidth: '70%',
    borderRadius: 16,
    borderTopLeftRadius: 4,
  },
  hintContainer: {
    position: 'absolute',
    bottom: 8,
    right: 8,
    backgroundColor: 'rgba(0, 0, 0, 0.5)',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 4,
  },
  hintText: {
    color: '#fff',
  },
});
```

**é¢„è§ˆåŠŸèƒ½ç‰¹ç‚¹**ï¼š
- å®æ—¶åæ˜ ä¸é€æ˜åº¦å˜åŒ–
- æ¨¡æ‹ŸçœŸå®èŠå¤©æ°”æ³¡æ ·å¼
- è‡ªåŠ¨é€‚é…æ˜æš—ä¸»é¢˜
- æä¾›è§†è§‰æç¤ºæ–‡å­—

**é¢„ä¼°å·¥ä½œé‡**ï¼š2 å°æ—¶

---

### é˜¶æ®µ 4ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯•

#### ä»»åŠ¡ 4.1ï¼šå›¾ç‰‡åŠ è½½æ€§èƒ½ä¼˜åŒ–

**ç›®æ ‡**ï¼šé¿å…å¤§å›¾ç‰‡å¯¼è‡´çš„å¡é¡¿å’Œå†…å­˜æº¢å‡º

**ä¼˜åŒ–æªæ–½**ï¼š

1. **å›¾ç‰‡å°ºå¯¸é™åˆ¶**ï¼ˆå·²åœ¨ä»»åŠ¡ 2.2 å®ç°ï¼‰
   - æœ€å¤§å®½åº¦ 1080px
   - JPEG å‹ç¼© 70%

2. **ä½¿ç”¨ expo-image æ›¿ä»£åŸç”Ÿ Image**ï¼ˆæ›´å¥½çš„ç¼“å­˜å’Œæ€§èƒ½ï¼‰

```bash
npm install expo-image
```

```tsx
// components/chat/ChatBackground.tsx
import { ImageBackground } from 'expo-image'; // æ›¿ä»£ react-native çš„ ImageBackground

<ImageBackground
  source={{ uri: settings.imagePath }}
  contentFit="cover"
  transition={200}                  // æ¸æ˜¾åŠ¨ç”»
  cachePolicy="memory-disk"         // å¯ç”¨å†…å­˜å’Œç£ç›˜ç¼“å­˜
  style={styles.background}
  imageStyle={{ opacity: settings.opacity }}
>
  {children}
</ImageBackground>
```

3. **å†…å­˜ç›‘æ§**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```typescript
// services/media/ImageStorage.ts
if (__DEV__) {
  export async function logImageInfo(path: string): Promise<void> {
    const info = await FileSystem.getInfoAsync(path);
    logger.debug('Background image info', {
      path,
      size: `${(info.size / 1024 / 1024).toFixed(2)} MB`,
      exists: info.exists,
    });
  }
}
```

4. **é™çº§ç­–ç•¥**

```tsx
// components/chat/ChatBackground.tsx
const handleImageError = () => {
  logger.warn('Background image failed to load, disabling custom background');
  Alert.alert(
    'èƒŒæ™¯åŠ è½½å¤±è´¥',
    'æ— æ³•åŠ è½½èƒŒæ™¯å›¾ç‰‡ï¼Œå·²æ¢å¤é»˜è®¤èƒŒæ™¯',
    [
      {
        text: 'ç¡®å®š',
        onPress: async () => {
          await updateImagePath(null);
        },
      },
    ]
  );
};

<ImageBackground
  source={{ uri: settings.imagePath }}
  onError={handleImageError}
>
```

**æ¶‰åŠæ–‡ä»¶**ï¼š
```
components/chat/ChatBackground.tsxï¼ˆä¿®æ”¹ï¼‰
package.jsonï¼ˆæ–°å¢ expo-image ä¾èµ–ï¼‰
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š3 å°æ—¶

---

#### ä»»åŠ¡ 4.2ï¼šè·¨å¹³å°å…¼å®¹æ€§æµ‹è¯•ï¼ˆä»… iOS å’Œ Androidï¼‰

**ç›®æ ‡**ï¼šç¡®ä¿åŠŸèƒ½åœ¨ iOS å’Œ Android ä¸¤ç«¯æ­£å¸¸å·¥ä½œ

**æµ‹è¯•ç‚¹**ï¼š

| æµ‹è¯•é¡¹ | iOS | Android | å¤‡æ³¨ |
|--------|-----|---------|------|
| å›¾ç‰‡é€‰æ‹©å™¨æƒé™è¯·æ±‚ | âœ… | âœ… | æµ‹è¯•æƒé™å¼¹çª—å’Œå¼•å¯¼ |
| å›¾ç‰‡å‹ç¼©å’Œä¼˜åŒ– | âœ… | âœ… | éªŒè¯å‹ç¼©åæ–‡ä»¶å¤§å° |
| æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ | âœ… | âœ… | éªŒè¯æ–‡ä»¶ä¿å­˜å’Œåˆ é™¤ |
| èƒŒæ™¯æ¸²æŸ“æ€§èƒ½ | âœ… | âœ… | æµ‹è¯•æ»šåŠ¨èŠå¤©æ—¶çš„å¸§ç‡ |
| æ˜æš—æ¨¡å¼åˆ‡æ¢ | âœ… | âœ… | éªŒè¯ä¸»é¢˜åˆ‡æ¢ä¸å½±å“èƒŒæ™¯ |
| æ¨ªç«–å±é€‚é… | âœ… | âœ… | æµ‹è¯•å±å¹•æ—‹è½¬æ—¶èƒŒæ™¯æ­£ç¡®ç¼©æ”¾ |
| ä¸é€æ˜åº¦æ»‘å— | âœ… | âœ… | éªŒè¯æ»‘å—æ‰‹åŠ¿å“åº”å’Œå€¼æ›´æ–° |
| å›¾ç‰‡åŠ è½½å¤±è´¥ | âœ… | âœ… | æµ‹è¯•é”™è¯¯æç¤ºå’Œé™çº§å¤„ç† |
| å­˜å‚¨ç©ºé—´ä¸è¶³ | âœ… | âœ… | æ¨¡æ‹Ÿä½å­˜å‚¨ç©ºé—´åœºæ™¯ |

**æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹**ï¼š

```typescript
// __tests__/background-settings.test.ts
describe('Background Settings', () => {
  it('should save background image and update database', async () => {
    const mockUri = 'file:///mock/image.jpg';
    const savedPath = await saveBackgroundImage(mockUri);
    expect(savedPath).toContain('backgrounds/current_background.jpg');

    const settings = await getBackgroundSettings();
    expect(settings.imagePath).toBe(savedPath);
  });

  it('should delete old background when saving new one', async () => {
    // ä¿å­˜ç¬¬ä¸€å¼ å›¾ç‰‡
    await saveBackgroundImage('file:///mock/image1.jpg');

    // ä¿å­˜ç¬¬äºŒå¼ å›¾ç‰‡
    await saveBackgroundImage('file:///mock/image2.jpg');

    // éªŒè¯åªæœ‰ä¸€å¼ å›¾ç‰‡å­˜åœ¨
    const dirContent = await FileSystem.readDirectoryAsync(BACKGROUND_DIR);
    expect(dirContent.length).toBe(1);
    expect(dirContent[0]).toBe('current_background.jpg');
  });

  it('should reset background settings', async () => {
    await updateBackgroundSettings({
      imagePath: '/path/to/image.jpg',
      opacity: 0.5,
      enabled: true,
    });

    await reset();

    const settings = await getBackgroundSettings();
    expect(settings.imagePath).toBeNull();
    expect(settings.opacity).toBe(0.3);
    expect(settings.enabled).toBe(false);
  });
});
```

**æ‰‹åŠ¨æµ‹è¯•æ¸…å•**ï¼š

```markdown
## iOS æµ‹è¯•
- [ ] é¦–æ¬¡æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨æ—¶æ˜¾ç¤ºæƒé™å¼¹çª—
- [ ] æƒé™è¢«æ‹’ç»åç‚¹å‡»"å»è®¾ç½®"å¯è·³è½¬åˆ°ç³»ç»Ÿè®¾ç½®
- [ ] é€‰æ‹©è¶…è¿‡ 10MB çš„å›¾ç‰‡æ—¶æç¤ºé”™è¯¯
- [ ] æ¨ªç«–å±åˆ‡æ¢æ—¶èƒŒæ™¯æ­£ç¡®é€‚é…
- [ ] æ˜æš—æ¨¡å¼åˆ‡æ¢æ—¶èƒŒæ™¯ä¿æŒæ˜¾ç¤º
- [ ] Slider æ»‘å—æ‰‹åŠ¿æµç•…ï¼Œæ— å¡é¡¿

## Android æµ‹è¯•
- [ ] é¦–æ¬¡æ‰“å¼€å›¾ç‰‡é€‰æ‹©å™¨æ—¶æ˜¾ç¤ºæƒé™å¼¹çª—
- [ ] æƒé™è¢«æ‹’ç»åç‚¹å‡»"å»è®¾ç½®"å¯è·³è½¬åˆ°åº”ç”¨è®¾ç½®
- [ ] é€‰æ‹©è¶…è¿‡ 10MB çš„å›¾ç‰‡æ—¶æç¤ºé”™è¯¯
- [ ] æ¨ªç«–å±åˆ‡æ¢æ—¶èƒŒæ™¯æ­£ç¡®é€‚é…
- [ ] æ˜æš—æ¨¡å¼åˆ‡æ¢æ—¶èƒŒæ™¯ä¿æŒæ˜¾ç¤º
- [ ] Slider æ»‘å—æ‰‹åŠ¿æµç•…ï¼Œæ— å¡é¡¿
- [ ] ä½ç«¯è®¾å¤‡ï¼ˆ2GB RAMï¼‰æ€§èƒ½æµ‹è¯•
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š4 å°æ—¶ï¼ˆç§»é™¤ Web å¹³å°åå‡å°‘ 1 å°æ—¶ï¼‰

---

#### ä»»åŠ¡ 4.3ï¼šè¾¹ç•Œæƒ…å†µå¤„ç†

**ç›®æ ‡**ï¼šå¤„ç†å¼‚å¸¸åœºæ™¯ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**åœºæ™¯æ¸…å•**ï¼š

1. **æƒé™è¢«æ‹’ç»**

```typescript
// services/media/ImagePicker.ts
if (status !== 'granted') {
  Alert.alert(
    'éœ€è¦ç›¸å†Œæƒé™',
    'è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å…è®¸ AetherLink è®¿é—®ç›¸å†Œ',
    [
      { text: 'å–æ¶ˆ', style: 'cancel' },
      { text: 'å»è®¾ç½®', onPress: () => Linking.openSettings() },
    ]
  );
}
```

2. **å›¾ç‰‡è¿‡å¤§ï¼ˆ>10MBï¼‰**

```typescript
// services/media/ImageStorage.ts
const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB

export async function validateImageSize(uri: string): Promise<boolean> {
  const info = await FileSystem.getInfoAsync(uri);

  if (info.size > MAX_FILE_SIZE) {
    Alert.alert('å›¾ç‰‡è¿‡å¤§', 'è¯·é€‰æ‹©å°äº 10MB çš„å›¾ç‰‡');
    return false;
  }

  return true;
}
```

3. **å­˜å‚¨ç©ºé—´ä¸è¶³**

```typescript
// services/media/ImageStorage.ts
const MIN_FREE_SPACE = 50 * 1024 * 1024; // 50MB

export async function checkStorageSpace(requiredMB: number = 10): Promise<boolean> {
  const freeSpace = await FileSystem.getFreeDiskStorageAsync();

  if (freeSpace < MIN_FREE_SPACE) {
    Alert.alert('å­˜å‚¨ç©ºé—´ä¸è¶³', 'è¯·æ¸…ç†è®¾å¤‡å­˜å‚¨åé‡è¯•ï¼ˆå»ºè®®ä¿ç•™è‡³å°‘ 50MB ç©ºé—´ï¼‰');
    return false;
  }

  return true;
}
```

4. **å›¾ç‰‡åŠ è½½å¤±è´¥**

```tsx
// components/chat/ChatBackground.tsx
<ImageBackground
  source={{ uri: settings.imagePath }}
  onError={() => {
    Alert.alert('èƒŒæ™¯åŠ è½½å¤±è´¥', 'å·²æ¢å¤é»˜è®¤èƒŒæ™¯');
    updateImagePath(null);
  }}
>
```

5. **æ•°æ®åº“å†™å…¥å¤±è´¥**

```typescript
// app/settings/appearance.tsx
try {
  const newPath = await saveBackgroundImage(uri);
  await updateImagePath(newPath);
} catch (error) {
  logger.error('Failed to save background settings', { error });

  // æ¸…ç†å·²ä¿å­˜çš„å›¾ç‰‡æ–‡ä»¶
  if (newPath) {
    await deleteBackgroundImage(newPath);
  }

  Alert.alert('ä¿å­˜å¤±è´¥', 'æ— æ³•ä¿å­˜èƒŒæ™¯è®¾ç½®ï¼Œè¯·ç¨åé‡è¯•');
}
```

6. **åº”ç”¨å¸è½½æ—¶æ¸…ç†æ–‡ä»¶**

```typescript
// åœ¨åº”ç”¨å¸è½½æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¸…ç† documentDirectory ä¸­çš„æ–‡ä»¶
// æ— éœ€é¢å¤–å¤„ç†
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š3 å°æ—¶

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥

- [ ] ç”¨æˆ·å¯ä»¥ä»è®¾å¤‡ç›¸å†Œé€‰æ‹©å›¾ç‰‡ï¼ˆiOS å’Œ Androidï¼‰
- [ ] å›¾ç‰‡è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–ï¼ˆâ‰¤1080px å®½åº¦ï¼ŒJPEG 70% è´¨é‡ï¼‰
- [ ] å›¾ç‰‡ä¿å­˜åˆ°åº”ç”¨ç§æœ‰ç›®å½•ï¼ˆ`${documentDirectory}backgrounds/`ï¼‰
- [ ] ä¸é€æ˜åº¦æ»‘å—èŒƒå›´ 10%-100%ï¼Œæ­¥è¿› 5%
- [ ] è®¾ç½®é¡µé¢æä¾›å®æ—¶é¢„è§ˆæ•ˆæœ
- [ ] ä¸»èŠå¤©é¡µé¢æ­£ç¡®æ¸²æŸ“èƒŒæ™¯å›¾ç‰‡
- [ ] å¯ç”¨/ç¦ç”¨å¼€å…³å·¥ä½œæ­£å¸¸
- [ ] é‡ç½®åŠŸèƒ½å¯æ¢å¤é»˜è®¤èƒŒæ™¯å¹¶æ¸…ç†å›¾ç‰‡æ–‡ä»¶
- [ ] é…ç½®æŒä¹…åŒ–åˆ° SQLite æ•°æ®åº“
- [ ] æƒé™è¢«æ‹’ç»æ—¶æœ‰å‹å¥½æç¤º
- [ ] ä»…ä¿ç•™å½“å‰èƒŒæ™¯ï¼Œæ›¿æ¢æ—¶è‡ªåŠ¨åˆ é™¤æ—§å›¾ç‰‡

### æ€§èƒ½æŒ‡æ ‡è¦æ±‚

- [ ] å›¾ç‰‡åŠ è½½æ—¶é—´ < 500msï¼ˆ1080p è®¾å¤‡ï¼‰
- [ ] èŠå¤©é¡µé¢æ¸²æŸ“å¸§ç‡ â‰¥ 55 FPS
- [ ] å•å¼ èƒŒæ™¯å›¾ç‰‡å¤§å° < 500KB
- [ ] åº”ç”¨å¯åŠ¨æ—¶é—´å¢åŠ  < 100ms
- [ ] å†…å­˜å ç”¨å¢åŠ  < 20MB

### è·¨å¹³å°å…¼å®¹æ€§ï¼ˆä»… iOS å’Œ Androidï¼‰

- [ ] iOSï¼šå›¾ç‰‡é€‰æ‹©ã€å­˜å‚¨ã€æ¸²æŸ“æ­£å¸¸
- [ ] Androidï¼šå›¾ç‰‡é€‰æ‹©ã€å­˜å‚¨ã€æ¸²æŸ“æ­£å¸¸
- [ ] æ˜æš—æ¨¡å¼åˆ‡æ¢ä¸å½±å“èƒŒæ™¯æ˜¾ç¤º
- [ ] æ¨ªç«–å±åˆ‡æ¢æ—¶èƒŒæ™¯æ­£ç¡®é€‚é…
- [ ] ä½ç«¯è®¾å¤‡ï¼ˆ2GB RAMï¼‰æ€§èƒ½å¯æ¥å—

### è¾¹ç•Œæƒ…å†µå¤„ç†

- [ ] å›¾ç‰‡å¤§äº 10MB æ—¶æ‹’ç»å¹¶æç¤º
- [ ] å­˜å‚¨ç©ºé—´ä¸è¶³æ—¶é˜»æ­¢ä¿å­˜å¹¶æç¤º
- [ ] å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶è‡ªåŠ¨ç¦ç”¨èƒŒæ™¯
- [ ] æƒé™è¢«æ‹’ç»æ—¶å¼•å¯¼ç”¨æˆ·åˆ°ç³»ç»Ÿè®¾ç½®
- [ ] æ•°æ®åº“å†™å…¥å¤±è´¥æ—¶æ¸…ç†å·²ä¿å­˜æ–‡ä»¶
- [ ] æ— æ•ˆå›¾ç‰‡è·¯å¾„æ—¶é™çº§åˆ°é»˜è®¤èƒŒæ™¯

---

## æ½œåœ¨é£é™©å’ŒæŒ‘æˆ˜

### æŠ€æœ¯éš¾ç‚¹

1. **å¤§å›¾ç‰‡æ€§èƒ½é—®é¢˜**
   - **é£é™©**ï¼šç”¨æˆ·é€‰æ‹©é«˜åˆ†è¾¨ç‡å›¾ç‰‡ï¼ˆå¦‚ 4Kï¼‰å¯èƒ½å¯¼è‡´å¡é¡¿
   - **å½±å“**ï¼šèŠå¤©ä½“éªŒä¸‹é™
   - **ç¼“è§£æªæ–½**ï¼šå¼ºåˆ¶å›¾ç‰‡å‹ç¼© + å°ºå¯¸é™åˆ¶ + ä½¿ç”¨ expo-image ä¼˜åŒ–ç¼“å­˜

2. **iOS ç›¸å†Œæƒé™é™åˆ¶**
   - **é£é™©**ï¼šiOS 14+ "æœ‰é™ç…§ç‰‡è®¿é—®"æ¨¡å¼å¯èƒ½å¯¼è‡´æƒé™æµç¨‹å¤æ‚
   - **å½±å“**ï¼šç”¨æˆ·å›°æƒ‘
   - **ç¼“è§£æªæ–½**ï¼šæä¾›æ¸…æ™°çš„æƒé™è¯´æ˜ï¼Œå¼•å¯¼ç”¨æˆ·é€‰æ‹©"å…è®¸è®¿é—®æ‰€æœ‰ç…§ç‰‡"

3. **Android ä½ç«¯è®¾å¤‡æ€§èƒ½**
   - **é£é™©**ï¼š2GB RAM è®¾å¤‡å¯èƒ½å‡ºç°å†…å­˜ä¸è¶³
   - **å½±å“**ï¼šåº”ç”¨å´©æºƒæˆ–å¡é¡¿
   - **ç¼“è§£æªæ–½**ï¼šä¸¥æ ¼é™åˆ¶å›¾ç‰‡å°ºå¯¸ï¼Œä½¿ç”¨ expo-image çš„å†…å­˜ä¼˜åŒ–

### å…¼å®¹æ€§é£é™©

1. **Slider ç»„ä»¶æ ·å¼ä¸€è‡´æ€§**
   - **é£é™©**ï¼š@react-native-community/slider åœ¨ iOS å’Œ Android ä¸Šæ ·å¼ä¸å®Œå…¨ä¸€è‡´
   - **ç¼“è§£æªæ–½**ï¼šé€šè¿‡ minimumTrackTintColor/maximumTrackTintColor/thumbTintColor ç»Ÿä¸€æ ·å¼

2. **æ–‡ä»¶ç³»ç»Ÿæƒé™**
   - **é£é™©**ï¼šæŸäº› Android ROM å¯èƒ½é™åˆ¶æ–‡ä»¶è®¿é—®
   - **ç¼“è§£æªæ–½**ï¼šä½¿ç”¨ documentDirectoryï¼ˆåº”ç”¨ç§æœ‰ç›®å½•ï¼‰é¿å…æƒé™é—®é¢˜

### ç”¨æˆ·ä½“éªŒé£é™©

1. **èƒŒæ™¯å›¾ç‰‡å½±å“æ–‡å­—å¯è¯»æ€§**
   - **é£é™©**ï¼šæŸäº›å›¾ç‰‡é¢œè‰²å¯èƒ½å¯¼è‡´èŠå¤©æ°”æ³¡æ–‡å­—éš¾ä»¥é˜…è¯»
   - **ç¼“è§£æªæ–½**ï¼š
     - å»ºè®®é»˜è®¤ä¸é€æ˜åº¦ 30%
     - åœ¨é¢„è§ˆç»„ä»¶ä¸­æ˜ç¡®æç¤º"è¯·é€‰æ‹©è‰²å½©æŸ”å’Œçš„å›¾ç‰‡"
     - è€ƒè™‘ä¸ºèŠå¤©æ°”æ³¡æ·»åŠ åŠé€æ˜èƒŒæ™¯è’™å±‚

2. **å­˜å‚¨ç©ºé—´æµªè´¹**ï¼ˆå·²è§£å†³ï¼‰
   - **æ–¹æ¡ˆ**ï¼šä»…ä¿ç•™å½“å‰èƒŒæ™¯ï¼Œæ›¿æ¢æ—¶è‡ªåŠ¨åˆ é™¤æ—§å›¾ç‰‡
   - **å­˜å‚¨å ç”¨**ï¼šå•å¼ å›¾ç‰‡ < 500KBï¼Œæ€»å ç”¨ < 1MB

---

## åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆv1.1ï¼‰

1. **èƒŒæ™¯å›¾ç‰‡åº“**
   - æä¾› 5-10 å¼ é¢„è®¾èƒŒæ™¯å›¾ç‰‡ä¾›å¿«é€Ÿé€‰æ‹©
   - å‡å°‘ç”¨æˆ·å¯»æ‰¾åˆé€‚å›¾ç‰‡çš„æ—¶é—´æˆæœ¬

2. **æ‹ç…§åŠŸèƒ½**
   - é›†æˆ `expo-camera`ï¼Œå…è®¸ç”¨æˆ·ç›´æ¥æ‹æ‘„ç…§ç‰‡ä½œä¸ºèƒŒæ™¯
   - é€‚ç”¨äºé£æ™¯ã€çº¯è‰²å¢™é¢ç­‰åœºæ™¯

3. **æ€§èƒ½ç›‘æ§**
   - åœ¨å¼€å‘ç¯å¢ƒä¸­æ·»åŠ æ€§èƒ½æŒ‡æ ‡é¢æ¿
   - æ˜¾ç¤ºèƒŒæ™¯æ¸²æŸ“å¸§ç‡ã€å›¾ç‰‡åŠ è½½æ—¶é—´ã€å†…å­˜å ç”¨

### ä¸­æœŸä¼˜åŒ–ï¼ˆv1.2ï¼‰

1. **èƒŒæ™¯å†å²è®°å½•**
   - å¯é€‰åŠŸèƒ½ï¼šä¿ç•™æœ€è¿‘ 3 å¼ èƒŒæ™¯ä¾›å¿«é€Ÿåˆ‡æ¢
   - æä¾›"æ¸…ç†èƒŒæ™¯ç¼“å­˜"åŠŸèƒ½

2. **æ™ºèƒ½èƒŒæ™¯æ¨è**
   - æ ¹æ®å½“å‰ä¸»é¢˜ï¼ˆæ˜æš—æ¨¡å¼ï¼‰æ¨èåˆé€‚çš„èƒŒæ™¯
   - æä¾›"æ¸…æ–°"ã€"æ¸©æš–"ã€"ç§‘æŠ€"ç­‰é¢„è®¾é£æ ¼

3. **èƒŒæ™¯æ•ˆæœå¢å¼º**
   - å¯é€‰åŠŸèƒ½ï¼šå¢åŠ æ¨¡ç³Šæ•ˆæœï¼ˆä½¿ç”¨ expo-blurï¼‰
   - æä¾›æ»¤é•œé€‰é¡¹ï¼ˆç°åº¦ã€æ£•è¤è‰²ç­‰ï¼‰

### é•¿æœŸä¼˜åŒ–ï¼ˆv2.0ï¼‰

1. **AI ç”ŸæˆèƒŒæ™¯**
   - é›†æˆ DALL-E æˆ– Stable Diffusion API
   - ç”¨æˆ·è¾“å…¥æ–‡å­—æè¿°ç”Ÿæˆä¸“å±èƒŒæ™¯
   - éœ€è¦è€ƒè™‘æˆæœ¬å’Œéšç§é—®é¢˜

2. **èƒŒæ™¯äº¤äº’æ•ˆæœ**
   - æ»‘åŠ¨èŠå¤©æ—¶èƒŒæ™¯äº§ç”Ÿè§†å·®æ•ˆæœï¼ˆParallaxï¼‰
   - æ”¯æŒæ‰‹åŠ¿ç¼©æ”¾èƒŒæ™¯å›¾ç‰‡

3. **Web å¹³å°æ”¯æŒ**
   - ä½¿ç”¨ IndexedDB å­˜å‚¨èƒŒæ™¯å›¾ç‰‡
   - æä¾›ä¸ç§»åŠ¨ç«¯ä¸€è‡´çš„åŠŸèƒ½ä½“éªŒ

---

## æ€»ç»“

æœ¬è§„åˆ’æ–‡æ¡£è¯¦ç»†æ‹†è§£äº†"è‡ªå®šä¹‰èƒŒæ™¯åŠŸèƒ½"çš„å®æ–½è·¯å¾„ï¼Œå…±åˆ†ä¸º **4 ä¸ªé˜¶æ®µã€13 ä¸ªä»»åŠ¡**ï¼Œé¢„ä¼°æ€»å·¥ä½œé‡çº¦ **26 å°æ—¶**ã€‚

### å·¥æ—¶åˆ†é…

| é˜¶æ®µ | ä»»åŠ¡æ•° | æ€»å·¥æ—¶ |
|------|--------|--------|
| é˜¶æ®µ 1ï¼šåŸºç¡€è®¾æ–½æ­å»º | 2 | 5 å°æ—¶ |
| é˜¶æ®µ 2ï¼šå›¾ç‰‡é€‰æ‹©ä¸å­˜å‚¨ | 2 | 6 å°æ—¶ |
| é˜¶æ®µ 3ï¼šUI å®ç° | 3 | 10 å°æ—¶ |
| é˜¶æ®µ 4ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯• | 3 | 10 å°æ—¶ |
| **æ€»è®¡** | **10** | **26 å°æ—¶** |

### æ ¸å¿ƒæŠ€æœ¯æ–¹æ¡ˆ

- **å›¾ç‰‡é€‰æ‹©**ï¼šexpo-image-picker
- **å›¾ç‰‡ä¼˜åŒ–**ï¼šexpo-image-manipulatorï¼ˆå‹ç¼©è‡³ 1080px å®½åº¦ï¼ŒJPEG 70% è´¨é‡ï¼‰
- **æœ¬åœ°å­˜å‚¨**ï¼šexpo-file-systemï¼ˆä»…ä¿ç•™å½“å‰èƒŒæ™¯ï¼‰
- **é…ç½®æŒä¹…åŒ–**ï¼šSQLiteï¼ˆæ‰©å±• settings è¡¨ï¼‰
- **UI ç»„ä»¶**ï¼šReact Native Paper + @react-native-community/slider
- **èƒŒæ™¯æ¸²æŸ“**ï¼šImageBackgroundï¼ˆä»…æ”¯æŒä¸é€æ˜åº¦è°ƒæ•´ï¼‰
- **å¹³å°æ”¯æŒ**ï¼šä»… iOS å’Œ Android

### å…³é”®å†³ç­–

1. âœ… ä½¿ç”¨å®˜æ–¹æ¨èçš„ @react-native-community/slider
2. âœ… ä»…ä¿ç•™å½“å‰èƒŒæ™¯ï¼Œæ›¿æ¢æ—¶åˆ é™¤æ—§å›¾ç‰‡
3. âœ… ä»…æ”¯æŒä¸é€æ˜åº¦è°ƒæ•´ï¼Œä¸æ”¯æŒæ¨¡ç³Šå’Œæ»¤é•œ
4. âœ… ä»…æ”¯æŒ iOS å’Œ Androidï¼Œä¸æ”¯æŒ Web

### å¼€å§‹å®æ–½å‰çš„å‡†å¤‡

1. å®‰è£…æ–°ä¾èµ–ï¼š
   ```bash
   npm install @react-native-community/slider@^4.5.4 expo-image
   ```

2. é…ç½®æƒé™ï¼ˆapp.jsonï¼‰ï¼š
   ```json
   {
     "expo": {
       "plugins": [
         ["expo-image-picker", {
           "photosPermission": "å…è®¸ AetherLink è®¿é—®æ‚¨çš„ç›¸å†Œä»¥é€‰æ‹©èŠå¤©èƒŒæ™¯å›¾ç‰‡"
         }]
       ]
     }
   }
   ```

3. åˆ›å»ºç›®å½•ç»“æ„ï¼š
   ```
   services/media/
   â”œâ”€â”€ ImagePicker.ts
   â””â”€â”€ ImageStorage.ts
   ```

4. è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬

**å‡†å¤‡å°±ç»ªåå³å¯å¼€å§‹å®æ–½ï¼ğŸš€**
